<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-learn/operations">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.1.0">
<title data-rh="true">Operations and Documents | p2panda</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://p2panda.org/learn/operations"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Operations and Documents | p2panda"><meta data-rh="true" name="description" content="Most of the time, whenever we do something, we usually do it in multiple steps. For example when we cook a good curry for our friends."><meta data-rh="true" property="og:description" content="Most of the time, whenever we do something, we usually do it in multiple steps. For example when we cook a good curry for our friends."><link data-rh="true" rel="icon" href="/images/deepsea-panda.svg"><link data-rh="true" rel="canonical" href="https://p2panda.org/learn/operations"><link data-rh="true" rel="alternate" href="https://p2panda.org/learn/operations" hreflang="en"><link data-rh="true" rel="alternate" href="https://p2panda.org/learn/operations" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.de076f58.css">
<link rel="preload" href="/assets/js/runtime~main.15fccfd6.js" as="script">
<link rel="preload" href="/assets/js/main.125a03bc.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function e(e){document.documentElement.setAttribute("data-theme",e)}var t=function(){var e=null;try{e=localStorage.getItem("theme")}catch(e){}return e}();null!==t?e(t):window.matchMedia("(prefers-color-scheme: dark)").matches?e("dark"):(window.matchMedia("(prefers-color-scheme: light)").matches,e("light"))}()</script><div id="__docusaurus">
<div role="region" aria-label="theme.common.skipToMainContent"><a href="#" class="skipToContent_fXgn">Skip to main content</a></div><nav class="navbar navbar--fixed-top navbarHideable_m1mJ"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><div class="navbar__brand"><div class="navbar__logo"><img src="/images/p2panda-book.png" class="themedImage_ToTc themedImage--light_HNdA"><img src="/images/p2panda-book.png" class="themedImage_ToTc themedImage--dark_i4oU"></div></div></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/images/p2panda-book.png" alt="p2panda Handbook" class="themedImage_ToTc themedImage--light_HNdA"><img src="/images/p2panda-book.png" alt="p2panda Handbook" class="themedImage_ToTc themedImage--dark_i4oU"></div></a><a class="navbar__item navbar__link" href="/about/">About</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/learn/">Learn</a><a class="navbar__item navbar__link" href="/tutorials/">Tutorials</a><a class="navbar__item navbar__link" href="/libraries/">Libraries</a><a class="navbar__item navbar__link" href="/specification/">Specification</a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/faq">FAQ</a><a class="navbar__item navbar__link" href="/links">Links</a><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebar_njMd sidebarWithHideableNavbar_wUlq"><a tabindex="-1" class="sidebarLogo_isFc" href="/"><img src="/images/p2panda-book.png" alt="p2panda Handbook" class="themedImage_ToTc themedImage--light_HNdA"><img src="/images/p2panda-book.png" alt="p2panda Handbook" class="themedImage_ToTc themedImage--dark_i4oU"></a><nav class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/learn/">Overview</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/learn/entries">Bamboo Entries</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" href="/learn/operations">Operations and Documents</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/learn/networks">Networks</a></li></ul></nav></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><img src="/images/deepsea-panda.svg" width="30" class="icon-home_wWeS"></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Operations and Documents</span><meta itemprop="position" content="1"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Operations and Documents</h1></header><p>Most of the time, whenever we do something, we usually do it in multiple steps. For example when we cook a good curry for our friends.</p><div class="image-frame_fg61"><div class="image-frame-inner_Xabn"><div style="background-size:cover;background-repeat:no-repeat;position:relative;background-image:url(&quot;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAJCAYAAAALpr0TAAAACXBIWXMAAAsTAAALEwEAmpwYAAABYElEQVQYlRXOvUsbYQCA8VsEJxFBBwsdi1YpuOrQD4e4aCGbizh0KEpXtVOhOhQUXPwLBAXd/BjqIAoqJkooWmxNLok2xpA7vS9j7nL3vvc+JfsPnkezfDtRqzv7KL75SnUD6zL4twG8jBv12dAqHwKjWs7S53autnA8I3tr8Db0fhEY29wLEg+Zn5nc5g9CpzqvAT2n5fS0budHgLZQZCcEj5NA+2PxMpFN7c0R1l5rCtVPFM8g5EcF7fJv7nNcKE4p6CCSYzz788AbLYzE14uSTbHq5K0weuccH+CkjrEbMmGYZub07BxgQYukHDrKmmvXFfcL0Ok1wiW37i8D3SXD/LR7kl4F3jcfu/K/z5LW/c0A0AJqEBgSxK1ALzAspHjRhLM3pQq24/6RMh7Ml8rcVqr4teiDG3jnBa/QTH/XFCTv9Kuc/WCsBIJX9lPt8K5qHslA9bkNd1H39KYc/w8+pCY5cjmtCAAAAABJRU5ErkJggg==&quot;)"><svg style="width:100%;height:auto;max-width:100%;margin-bottom:-4px" width="904" height="868"></svg><noscript><img style="width:100%;height:auto;max-width:100%;margin-bottom:-4px;position:absolute;top:0;left:0" src="/assets/ideal-img/cooking-curry-for-friends.7e640cd.904.png" srcset="/assets/ideal-img/cooking-curry-for-friends.7e640cd.904.png 904w" alt="Cooking curry for friends" width="904" height="868"></noscript></div></div><div class="image-frame-title_UNlE">Cooking curry for friends</div></div><p>We can think of many other examples, but all of them have one thing in common: Every step changes the <em>state</em> of things.</p><div class="theme-admonition theme-admonition-tip alert alert--success admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><span class="panda-icon">üêª‚Äç‚ùÑÔ∏è</span></span>Shirokuma Cafe</div><div class="admonitionContent_S0QG"><p>When adding salt to your curry it will become salty.</p></div></div><p>In p2panda we have a data type to describe a change of <em>something</em>. We call this data type an <strong>Operation</strong>. We can think about it as steps to achieve a task, like writing a message, cooking a meal or uploading an image.</p><p>Operations are the core of p2panda, they can come in different shapes and surely there will be many more to come in the future. Maybe you have some ideas for new p2panda Operations?</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="operation-actions">Operation Actions<a class="hash-link" href="#operation-actions" title="Direct link to heading">‚Äã</a></h2><p>Another way to look at Operations is to see them as a chain of actions we apply to something, for example updating our current username.</p><div class="image-frame_fg61"><div class="image-frame-inner_Xabn"><div style="background-size:cover;background-repeat:no-repeat;position:relative;background-image:url(&quot;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAICAYAAADA+m62AAAACXBIWXMAAAsTAAALEwEAmpwYAAABJUlEQVQYlU2OzStEYRjFzy0NBpGdppSljWz8Bf4AGhYzU3cs2IyFpYX1KIU0pXu5Mhs72ShlISmyUZpoGE2ysMC44c4H73s/3ufRnRo5deqcfmdxQERgZhRu7wC0dwLoBdAHRKM3xVKThQYR9RDREDPHmLlLCDkopRv2bmYeCBkR9YfrBaUUK6Vs6Xph/g58n6UUi0GgHgKlmJkteJ6f+PxyHp1q7cT1vFSt8XNWlcG5zxwXUh7U6vUyES39fQhdKVxgL4LI22Zq7MNIDf9nraC9nm61lYwkOJ8ZtfPz/G7NllvMf7rSIITA/qWF8d0JTB9mOqzt9OSLqc/Zhj7CABrP96heH6Gp7E5aW8slsWKlY6vZuMnLCRRNHRvrU3COc6iYM/gFSZvPNWoGKyEAAAAASUVORK5CYII=&quot;)"><svg style="width:100%;height:auto;max-width:100%;margin-bottom:-4px" width="1036" height="884"></svg><noscript><img style="width:100%;height:auto;max-width:100%;margin-bottom:-4px;position:absolute;top:0;left:0" src="/assets/ideal-img/updating-username-with-operations.43f0d59.1036.png" srcset="/assets/ideal-img/updating-username-with-operations.43f0d59.1036.png 1036w" alt="Updating username with Operations" width="1036" height="884"></noscript></div></div><div class="image-frame-title_UNlE">Updating username with Operations</div></div><p>To describe this Operation we could say: ‚ÄúEvery Operation updates our username‚Äù and this is also exactly how p2panda Operations work: We can define UPDATE Operations on data, like usernames! And there is a little bit more: The first Operation is always CREATE, to announce that there is a new username at all. And maybe you want to also DELETE it even again at one point.</p><p>These are the three different <strong>Operation Actions</strong> p2panda currently has: CREATE, UPDATE and DELETE.</p><div class="theme-admonition theme-admonition-note alert alert--secondary admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><span class="panda-icon">üêß</span></span>Why do we write them like that?</div><div class="admonitionContent_S0QG"><p>We write the Operation Actions in UPPERCASE just to make clear it is a defined constant and not an English verb in a regular sentence.</p></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="documents">Documents<a class="hash-link" href="#documents" title="Direct link to heading">‚Äã</a></h2><p>As we‚Äôre applying our Operations always to <em>something</em> we need a term for that. In p2panda we call this a <strong>Document</strong>. It is the result of a series of Operations!</p><p>For example: In our initial cooking scenario the series of Operations would lead to a Curry-Document, when updating our username it would lead to a Username-Document.</p><p>To create a new Document we send a CREATE Operation, to update it we follow with UPDATE Operations and then eventually we want to delete it with a final DELETE Operation.</p><div class="image-frame_fg61"><div class="image-frame-inner_Xabn"><div style="background-size:cover;background-repeat:no-repeat;position:relative;background-image:url(&quot;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAADCAYAAACqPZ51AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAhklEQVQImQF7AIT/APX3+AD///8AAAAABBAiMg4RIzMQAAYYCAAADgMIHTAKGSg1Biw7SAYA8vP0eu3v8V7w8fJ87O7waO7w8XDt7/B07O7vYPP09YP///8AfYaNAADj5ukkys7SHtja3CLP0tUd0dTWIN3f4R////8U/f39H7O4vQEAAAAAbLA/cb8kVBwAAAAASUVORK5CYII=&quot;)"><svg style="width:100%;height:auto;max-width:100%;margin-bottom:-4px" width="1798" height="650"></svg><noscript><img style="width:100%;height:auto;max-width:100%;margin-bottom:-4px;position:absolute;top:0;left:0" src="/assets/ideal-img/lifetime-of-a-document.90f9699.1798.png" srcset="/assets/ideal-img/lifetime-of-a-document.90f9699.1798.png 1798w" alt="Lifetime of a Document" width="1798" height="650"></noscript></div></div><div class="image-frame-title_UNlE">Lifetime of a Document</div></div><p>If there is a DELETE Operation in the Document then the complete Document can be considered deleted. In the following example we have Operations updating <em>diary entry</em> Documents. The user created already 3 Documents but deleted one recently.</p><div class="image-frame_fg61"><div class="image-frame-inner_Xabn"><div style="background-size:cover;background-repeat:no-repeat;position:relative;background-image:url(&quot;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAGCAYAAAD68A/GAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA/0lEQVQImRXKvUvDQByH8a+1gi+og5suKi7NJlEoIohIN1Gc1alVkUOHLDoHHIXMGYJLhszpWDC4lNKg/4JgfYkxiZL73cU6nORZPw/07b1JAGNCyquc0wUJ0eIkTolEk5M4yzm1iuL3GqtbuzMAJjiJ25zTTZyk80maLUfx12KSZkuD92gqSbNprO/sjwOoyqK4JCFOONHx909+KKQ8krI4H7x9gHMCtHoDcys6os8Yzy+vCB+fFjr3Dxt+uz3b7fXR7fVHhsM/oFZvoKZvQilVVUohCAI7DENl23bTcRy4rjuKshI1TYPv+xXP82Ca5oFlWXeMsTXGGAzDqJTPPx6EiWjfsfHlAAAAAElFTkSuQmCC&quot;)"><svg style="width:100%;height:auto;max-width:100%;margin-bottom:-4px" width="1900" height="1130"></svg><noscript><img style="width:100%;height:auto;max-width:100%;margin-bottom:-4px;position:absolute;top:0;left:0" src="/assets/ideal-img/deleted-documents-do-not-show.a695ee2.1900.png" srcset="/assets/ideal-img/deleted-documents-do-not-show.a695ee2.1900.png 1900w" alt="Deleted Documents will not show up anymore" width="1900" height="1130"></noscript></div></div><div class="image-frame-title_UNlE">Deleted Documents will not show up anymore</div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="operation-fields">Operation Fields<a class="hash-link" href="#operation-fields" title="Direct link to heading">‚Äã</a></h2><p>Documents are simple <em>Key-Value Maps</em> which means that there is always a name of a field connected to some value. An User-Profile-Document could for example look like that:</p><div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#d3d0c8;--prism-background-color:#2d2d2d"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#d3d0c8"><span class="token punctuation" style="color:#f2f0ec">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d3d0c8"><span class="token plain">  </span><span class="token property">&quot;username&quot;</span><span class="token operator" style="color:#f2f0ec">:</span><span class="token plain"> </span><span class="token string" style="color:#cc99cc">&quot;panda&quot;</span><span class="token punctuation" style="color:#f2f0ec">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d3d0c8"><span class="token plain">  </span><span class="token property">&quot;is_cute&quot;</span><span class="token operator" style="color:#f2f0ec">:</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token punctuation" style="color:#f2f0ec">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d3d0c8"><span class="token plain">  </span><span class="token property">&quot;city&quot;</span><span class="token operator" style="color:#f2f0ec">:</span><span class="token plain"> </span><span class="token string" style="color:#cc99cc">&quot;Shirokuma Town&quot;</span><span class="token punctuation" style="color:#f2f0ec">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d3d0c8"><span class="token plain">  </span><span class="token property">&quot;favorite_food&quot;</span><span class="token operator" style="color:#f2f0ec">:</span><span class="token plain"> </span><span class="token string" style="color:#cc99cc">&quot;Bamboo&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d3d0c8"><span class="token plain"></span><span class="token punctuation" style="color:#f2f0ec">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>When we create a new Document with a CREATE Operation we have to make sure that all <strong>Operation Fields</strong> are given. For UPDATE Operations we only have to mention the fields we want to change. DELETE Operations do not need to mention any fields as we‚Äôre simply just telling everyone that we want the Document to be deleted.</p><div class="image-frame_fg61"><div class="image-frame-inner_Xabn"><div style="background-size:cover;background-repeat:no-repeat;position:relative;background-image:url(&quot;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAGCAYAAAD68A/GAAAACXBIWXMAAAsTAAALEwEAmpwYAAABAUlEQVQImQH2AAn/AKy4w1y+ytR4xtLcaaKvuSKfrLcfxdHbHMbR2xSJlqEZr7vFIsfT3RIAusbQzbPAyv+6xtD/vMjTiL3J0+u+ytT0vsrUubrG0I69ydP/vsvVpAC9ydNPvsrUdL3J02m0wcwYh5emEpemsxWZrLwMrrvGDLzH0Ru5xc8RAL3J0wC9ydMAuMPMAKCkpw6tsrYu5OTlGri3tnypqKgys7i8AMne8AAAvsrUA9jf5Aj///8A+Pj5Ze7v8P/09fX/8fHx+NjY2Bzi3tsA19vfAgAAAAAA+Pj4A/j4+QD5+fpS8PHy2u/w8dT7+/ux////Av///wD///8AVjaiSm0ChIMAAAAASUVORK5CYII=&quot;)"><svg style="width:100%;height:auto;max-width:100%;margin-bottom:-4px" width="1780" height="1084"></svg><noscript><img style="width:100%;height:auto;max-width:100%;margin-bottom:-4px;position:absolute;top:0;left:0" src="/assets/ideal-img/updating-operation-fields.89dc008.1780.png" srcset="/assets/ideal-img/updating-operation-fields.89dc008.1780.png 1780w" alt="Updating Operation Fields" width="1780" height="1084"></noscript></div></div><div class="image-frame-title_UNlE">Updating Operation Fields</div></div><p>With this we can imagine more complex Documents which can contain many different sorts of fields!</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="operation-field-types">Operation Field Types<a class="hash-link" href="#operation-field-types" title="Direct link to heading">‚Äã</a></h2><p>In the above example we could already see two different sorts of <strong>Operation Values</strong>. <code>panda</code> and <code>city</code> and <code>favorite_food</code> were strings, but <code>is_cute</code> was a boolean! p2panda currently supports the following basic <strong>Operation Field Types</strong>:</p><ul><li><code>str</code> Strings of any length, like <code>‚ÄùHello, World!‚Äù</code></li><li><code>bool</code> Either <code>true</code> or <code>false</code></li><li><code>int</code> i64 integer numbers, like <code>511</code> or <code>829187401</code></li><li><code>float</code> f64 float numbers, like <code>12.52</code> or <code>-255.12</code></li></ul><div class="theme-admonition theme-admonition-note alert alert--secondary admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><span class="panda-icon">üêß</span></span>More to come!</div><div class="admonitionContent_S0QG"><p>There will surely be more Operation Values in the future! An array would be good for example.</p></div></div><div class="theme-admonition theme-admonition-note alert alert--secondary admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><span class="panda-icon">üêß</span></span>Relations</div><div class="admonitionContent_S0QG"><p>Next to the basic types there are also <em>Relations</em>. We will cover them in another chapter.</p></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="schema">Schema<a class="hash-link" href="#schema" title="Direct link to heading">‚Äã</a></h2><p>Our User-Profile-Document has a specific shape which needs to be fulfilled:</p><div class="image-frame_fg61"><div class="image-frame-inner_Xabn"><div style="background-size:cover;background-repeat:no-repeat;position:relative;background-image:url(&quot;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAFCAYAAAB8ZH1oAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAxUlEQVQImWNYtWq137q1a6oZGBjY3n75yfT//38GGI5KK2CQ1rZk0DB3YWC4fPWGydE9W7P0ZHm4GRgYGJEVRqcXMktrWzJpmLswMhw7foJh5+49DHduXGN48eq11sPHT53OX75ufPr8ZW0GBgYmJ/9oDg1zF2aG3LJ61ozCKl6QCd++fy/8/v3Hyq/fftR9+PQlCyQWn1XMrWXpxszgHZnK2DNpBgtI8OOnz1UfP37a8eHTl463Hz4WgMSmzFnEpmPtwQgAzmRovPZJ9gQAAAAASUVORK5CYII=&quot;)"><svg style="width:100%;height:auto;max-width:100%;margin-bottom:-4px" width="1672" height="870"></svg><noscript><img style="width:100%;height:auto;max-width:100%;margin-bottom:-4px;position:absolute;top:0;left:0" src="/assets/ideal-img/panda-defining-a-schema.c51b8da.1672.png" srcset="/assets/ideal-img/panda-defining-a-schema.c51b8da.1672.png 1672w" alt="Panda defining a Schema" width="1672" height="870"></noscript></div></div><div class="image-frame-title_UNlE">Panda defining a Schema</div></div><p>Everyone in the p2panda network can define the shape of a Document and announce it in form of a <strong>Schema</strong>. Now users can refer to that Schema by using its identifier, the <strong>Schema Id</strong>. Whenever they publish an Operation with a certain Schema Id, the Operation needs to match the fields of the given Schema.</p><div class="theme-admonition theme-admonition-note alert alert--secondary admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><span class="panda-icon">üêß</span></span>More validation</div><div class="admonitionContent_S0QG"><p>Currently schemas prescribe only the <code>name</code> and <code>type</code> of a field, but later we will have <code>regex</code>, <code>min</code>, <code>max</code> and many other validation methods as well, to restrict the data even more to a certain shape.</p></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="encoding">Encoding<a class="hash-link" href="#encoding" title="Direct link to heading">‚Äã</a></h2><p>After we‚Äôve created an operation we usually want to <strong>publish</strong> by sending it to our node. For this we take the following steps:</p><ol><li>Encode the operation</li><li>Create a new Bamboo entry and use operation as its payload</li><li>Sign and encode the entry</li><li>Send entry and operation to node</li></ol><div class="theme-admonition theme-admonition-tip alert alert--success admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><span class="panda-icon">üêª‚Äç‚ùÑÔ∏è</span></span>Check out the other learn sections</div><div class="admonitionContent_S0QG"><p>We will not talk about <a href="/learn/entries">Entries</a> and <a href="/learn/networks">Nodes</a> here, but for both parts we have other learn sections. If you‚Äôre curious you should check them out!</p></div></div><p>For Operations the <a href="http:///handbook/data-types/operations" target="_blank" rel="noopener noreferrer">specification</a> prescribes an <strong>Operation Format</strong>. Here is an example of how to format an CREATE operation:</p><div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#d3d0c8;--prism-background-color:#2d2d2d"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#d3d0c8"><span class="token punctuation" style="color:#f2f0ec">[</span><span class="token number" style="color:#cc99cc">1</span><span class="token punctuation" style="color:#f2f0ec">,</span><span class="token plain"> </span><span class="token number" style="color:#cc99cc">0</span><span class="token punctuation" style="color:#f2f0ec">,</span><span class="token plain"> </span><span class="token string" style="color:#cc99cc">&quot;profile_0020...&quot;</span><span class="token punctuation" style="color:#f2f0ec">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#f2f0ec">{</span><span class="token plain"> </span><span class="token property">&quot;username&quot;</span><span class="token operator" style="color:#f2f0ec">:</span><span class="token plain"> </span><span class="token string" style="color:#cc99cc">&quot;Panda&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#f2f0ec">}</span><span class="token punctuation" style="color:#f2f0ec">]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>We can see here that Operations are encoded as an array with a couple of fields inside which might already look familiar to us:</p><ol><li>The first field indicates the <strong>Operation Version</strong>. It helps us to understand what encoding we can expect from the following data when we receive a new Operation from somewhere. It is set to <code>1</code> here which is the first version.</li><li>The second field indicates the <strong>Operation Action</strong> we already talked about before. <code>0</code> stands for CREATE, <code>1</code> for UPDATE and <code>2</code> for DELETE. In this example we‚Äôre looking at a CREATE Operation.</li><li>The third field indicates the <strong>Schema Id</strong> we also talked about before. In the example it&#x27;s shortened, but we can imagine that this is where we set what schema this operation wants to fulfil.</li><li>The fourth and last field here are the <strong>Operation Fields</strong> with the actual application data we want to publish.</li></ol><p>This Operation Format will be now encoded as CBOR bytes which is a well known and slim encoding format. This is how it would look like (bytes represented as hexadecimal numbers):</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#d3d0c8;--prism-background-color:#2d2d2d"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#d3d0c8"><span class="token plain">84                                   # array(4)</span><br></span><span class="token-line" style="color:#d3d0c8"><span class="token plain">   01                                # unsigned(1)</span><br></span><span class="token-line" style="color:#d3d0c8"><span class="token plain">   00                                # unsigned(0)</span><br></span><span class="token-line" style="color:#d3d0c8"><span class="token plain">   6F                                # text(15)</span><br></span><span class="token-line" style="color:#d3d0c8"><span class="token plain">      70726F66696C655F303032302...   # &quot;profile_0020...&quot;</span><br></span><span class="token-line" style="color:#d3d0c8"><span class="token plain">   A1                                # map(1)</span><br></span><span class="token-line" style="color:#d3d0c8"><span class="token plain">      68                             # text(8)</span><br></span><span class="token-line" style="color:#d3d0c8"><span class="token plain">         757365726E616D65            # &quot;username&quot;</span><br></span><span class="token-line" style="color:#d3d0c8"><span class="token plain">      65                             # text(5)</span><br></span><span class="token-line" style="color:#d3d0c8"><span class="token plain">         50616E6461                  # &quot;Panda&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>We would send this data to a p2panda node, of course without the comments and with a complete schema id:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#d3d0c8;--prism-background-color:#2d2d2d"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#d3d0c8"><span class="token plain">840100784C70726F66696C655F3030323034336233653664613933366633633937663732373666303766363562303361303632373235666436363963323563373738653665653165336136333565393264A168757365726E616D656550616E6461</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>You can decode this data again using the <a href="https://cbor.me" target="_blank" rel="noopener noreferrer">https://cbor.me</a> playground. Just paste the hexadecimal string into the right area and click on the left-facing arrow button to decode the CBOR data. It also works the other way around!</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="operation-id">Operation Id<a class="hash-link" href="#operation-id" title="Direct link to heading">‚Äã</a></h2><p>Whenever we encode an Operation and sign it with an Bamboo Entry we <em>sign</em> the data and make it <em>immutable</em> from that point on. If we would change the Operation now afterwards, the <em>Signature</em> would break and we would need to reject this Operation as something invalid.</p><div class="theme-admonition theme-admonition-tip alert alert--success admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><span class="panda-icon">üêª‚Äç‚ùÑÔ∏è</span></span>Thank you Bamboo üíò</div><div class="admonitionContent_S0QG"><p>Bamboo Entries <em>seal</em> Operations for us. They are the data type which makes sure that nobody tampered with our data after we‚Äôve sent it out.</p></div></div><p>Since we used an Bamboo Entry to get this security and immutability we also receive a unique identifier after signing, encoding and hashing it: The Hash of the Entry becomes our <strong>Operation Id</strong>. It is an unique sequence of numbers which will indicate that we exactly want to refer to <em>this</em> Operation.</p><div class="image-frame_fg61"><div class="image-frame-inner_Xabn"><div style="background-size:cover;background-repeat:no-repeat;position:relative;background-image:url(&quot;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAGCAYAAAD68A/GAAAACXBIWXMAAAsTAAALEwEAmpwYAAABAUlEQVQImQH2AAn/ACmE1YQ0jNmwM4rXrSmH2ZdRdYYN/wAAAJ1QZADdmsIAov/0AP8pnQAAKofY2DWO2/81itX/Kofa/8G/oV+Nqn5saZlvieqj1Tr///8ApXTLAQATetQseJ7VdFOT1FEfgdM3VoDaBEZsRw5UXUgf067IT8nu3Sq9jNEAADCY3gDro7ZV/6hCC0mR4gD/fwAAKYgEAIuAjQCHRrAYr3DFRLAaxBcAcZYmAGWge25MjWBZr8QzAACfxAGoRakDwyjaALg0y225OM3NujbOlwDcriIv0a0wbtezNWbwvCNQ7LwoEPHEGwAAAP8AxDfWBsY62A26L80JcLhzn47i20MAAAAASUVORK5CYII=&quot;)"><svg style="width:100%;height:auto;max-width:100%;margin-bottom:-4px" width="2212" height="1420"></svg><noscript><img style="width:100%;height:auto;max-width:100%;margin-bottom:-4px;position:absolute;top:0;left:0" src="/assets/ideal-img/process-to-create-an-operation-id.2df6eaf.2212.png" srcset="/assets/ideal-img/process-to-create-an-operation-id.2df6eaf.2212.png 2212w" alt="Process to create an Entry Hash aka Operation Id" width="2212" height="1420"></noscript></div></div><div class="image-frame-title_UNlE">Process to create an Entry Hash aka Operation Id</div></div><p>There are a couple of steps involved to achieve this: The Operation gets encoded as we‚Äôve just learned, then hashed for the Bamboo Entry where it will be inserted as the <em>Payload Hash</em>. The Bamboo Entry gets signed, encoded and then hashed as well. <em>That</em> resulting Entry Hash will be our Operation Id!</p><div class="theme-admonition theme-admonition-info alert alert--info admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><span class="panda-icon">üêº</span></span>One more step</div><div class="admonitionContent_S0QG"><p>Hui! Actually, if we want to be really precise: Before signing the Entry it already gets encoded once, just without the Signature. After signing it it gets encoded <em>again</em> this time with the Signature.</p></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="document-id">Document Id<a class="hash-link" href="#document-id" title="Direct link to heading">‚Äã</a></h2><p>This is a fairly short section, but an important one:</p><p>Every Document we‚Äôve created in p2panda has an unique identifier, the <strong>Document Id</strong>. Where does it come from? It is the Operation Id of the CREATE Operation which created that Document! This works because there will always only be one CREATE Operation per Document.</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="document-views">Document Views<a class="hash-link" href="#document-views" title="Direct link to heading">‚Äã</a></h2><p>So far we‚Äôve only talked about creating Documents, but how does the Operation need to look like if we want to update or delete them?</p><p>Similar to how you would refer to a row in a SQL database by its unique identifier we have to specify <em>which</em> document we want to update or delete.</p><p>In p2panda everything can happen, since it is a decentralised system, so we need to be prepared for many users updating a document at the same time. Or someone updated something, but did it when they were offline! As a thought experiment, let‚Äôs imagine multiple updates to the same document:</p><div class="image-frame_fg61"><div class="image-frame-inner_Xabn"><div style="background-size:cover;background-repeat:no-repeat;position:relative;background-image:url(&quot;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAGCAYAAAD68A/GAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA/UlEQVQImWOQ1bFk0LL2Ymjqn80AAmcvXDY9efaC0+lzF2UWr9nMwMCtyCCpYcrAoGJkzxoYm85v4R3FfeH6HeFfv349/vnz1/9fv383/v//nyG7rF5Uz9KZFWwKA5sJKwMDJ8uVm/dFfvz48e3L1y//f//+0w1SOGXVHkEG/35GBp/UaobFS5a5LFq8RJFZPoTh////Hv////f///+/1qFjpxjS0zOMKrKSBBmuXzzFsHH92kkb1q3yObt3IsOjzboqL/a5Jd67fgRsWXZ21rpFc2caM6xZs4ZB2S6agYHhP8PL/REML/bHBbw6mrgc4iYGhvqGOon///8zAQCWbG8RctrpTQAAAABJRU5ErkJggg==&quot;)"><svg style="width:100%;height:auto;max-width:100%;margin-bottom:-4px" width="1356" height="868"></svg><noscript><img style="width:100%;height:auto;max-width:100%;margin-bottom:-4px;position:absolute;top:0;left:0" src="/assets/ideal-img/two-users-updating-at-the-same-time.28b02c8.1356.png" srcset="/assets/ideal-img/two-users-updating-at-the-same-time.28b02c8.1356.png 1356w" alt="Two users updating a document at the same time" width="1356" height="868"></noscript></div></div><div class="image-frame-title_UNlE">Two users updating a document at the same time</div></div><p>Who was first? That‚Äôs hard to tell! Usually we would just say that who has written last to the database will <em>win</em>. If Elephant was slightly later sending its change it would say <code>My name is: ‚ÄúElephant‚Äù</code>. In p2panda we don‚Äôt have that central server though which just <em>knows</em> who arrived later. We have many independent nodes where the updates might arrive differently. On the node of Penguin it might say <code>My name is: ‚ÄúElephant‚Äù</code> and on the node of the Elephant it‚Äôs <code>My name is: ‚ÄúPenguin‚Äù</code>, because the foreign updates arrived later due to the networking delays .. This is horrible!</p><p>To fix this problem we need to <em>know</em> what Penguin and Elephant did <em>see</em> when they updated the document. What was their last <em>point of view</em> when they wanted to update something? Maybe the Penguin only saw the original ‚ÄúPanda‚Äù profile and applied its changes, but Elephant saw later that Penguin made an update and applied its changes afterwards?</p><p>For this we ask the user to also publish a <code>previous</code> field inside of every Operation if they want to update or delete a document. Inside this <code>previous</code> field they can specify what the latest <strong>Document View</strong> was what they knew about.</p><div class="image-frame_fg61"><div class="image-frame-inner_Xabn"><div style="background-size:cover;background-repeat:no-repeat;position:relative;background-image:url(&quot;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAFCAYAAAB8ZH1oAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA2ElEQVQImQHNADL/AObq7ZLc4eTH5+rtvu7x9MDx9PbA8PP1wO7x9MH09PYuYtHFAASnlgAA7vDy0+rs7v/m6uz/7O7w/+vu8P/o7O7/8/P1/9vs7UsTo5WKJrGjegD19/iC9ff5q+bo8rL09vir6Ovzrurt87D29vem2O7tLxOrnGgksKJhAAAAAAKUl5hAd27/CFFUZS0dFlINkJG9JouPkCqfsrEAFbGhACGvoQAAxcXECsC/v2guK1YAcnFvQn96cRbJx7gTtrOxMraurABKr6QFIq+gA9Laf8m0dMu2AAAAAElFTkSuQmCC&quot;)"><svg style="width:100%;height:auto;max-width:100%;margin-bottom:-4px" width="2150" height="1036"></svg><noscript><img style="width:100%;height:auto;max-width:100%;margin-bottom:-4px;position:absolute;top:0;left:0" src="/assets/ideal-img/document-views.a482222.2150.png" srcset="/assets/ideal-img/document-views.a482222.2150.png 2150w" alt="Document Views" width="2150" height="1036"></noscript></div></div><div class="image-frame-title_UNlE">Document Views</div></div><p>Whenever an Operation takes place, it will generate a new Document View. We can understand them as a <em>version</em> or <em>revision</em> of our Documents. When sending a CREATE Operation there is one Document and one Document View, both will contain the same data, as so far there is only one version of it. </p><p>After we‚Äôve sent an UPDATE Operation things get more interesting: We still only have one Document, containing the latest changes, but gain one more Document View! The Document will always contain the sum of all changes, but we keep track of its <em>history</em> with many Document Views.</p><p>In our Elephant / Penguin example we can see that indeed the Penguin applied its UPDATE Operation onto the original Document View of the Panda, followed by the Elephant. So what is the content of this Document? It is <code>My name is: ‚ÄúElephant!</code>. üêò How can we be sure? It is because we follow the rule <strong>Last Write Wins</strong> and with the help of the <code>previous</code> fields we can trace back who was <em>last</em>.</p><p>We encode UPDATE Operations like that: </p><div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#d3d0c8;--prism-background-color:#2d2d2d"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#d3d0c8"><span class="token punctuation" style="color:#f2f0ec">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d3d0c8"><span class="token plain">  </span><span class="token number" style="color:#cc99cc">1</span><span class="token punctuation" style="color:#f2f0ec">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d3d0c8"><span class="token plain">  </span><span class="token number" style="color:#cc99cc">1</span><span class="token punctuation" style="color:#f2f0ec">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d3d0c8"><span class="token plain">  </span><span class="token string" style="color:#cc99cc">&quot;profile_0020...&quot;</span><span class="token punctuation" style="color:#f2f0ec">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d3d0c8"><span class="token plain">  </span><span class="token punctuation" style="color:#f2f0ec">[</span><span class="token string" style="color:#cc99cc">&quot;0020...&quot;</span><span class="token punctuation" style="color:#f2f0ec">]</span><span class="token punctuation" style="color:#f2f0ec">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d3d0c8"><span class="token plain">  </span><span class="token punctuation" style="color:#f2f0ec">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d3d0c8"><span class="token plain">    </span><span class="token property">&quot;username&quot;</span><span class="token operator" style="color:#f2f0ec">:</span><span class="token plain"> </span><span class="token string" style="color:#cc99cc">&quot;Penguin&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d3d0c8"><span class="token plain">  </span><span class="token punctuation" style="color:#f2f0ec">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d3d0c8"><span class="token plain"></span><span class="token punctuation" style="color:#f2f0ec">]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Note that the Operation Action changed to <code>1</code> now, which indicates that this is an UPDATE Operation now. Also there is a new field appearing after the Schema Id, which is the <code>previous</code> field. It contains the Document View Id where we want to apply the update to.</p><p>UPDATE Operations do not require us to mention <em>all</em> Operation Fields anymore, we only need to write the ones we want to update.</p><p>DELETE Operations also have a <code>previous</code> field: We have to mention from what point on we want this document to be deleted. Currently it will just cause the Document to be removed, but we will learn later that there are some interesting features around this sort of behaviour.</p><p>The encoding of DELETE Operations is similar, just that the Operation Action is <code>2</code> and we don‚Äôt need to specify any Operation Fields since we just wanted to say that we would like to delete the document:</p><div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#d3d0c8;--prism-background-color:#2d2d2d"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#d3d0c8"><span class="token punctuation" style="color:#f2f0ec">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d3d0c8"><span class="token plain">  </span><span class="token number" style="color:#cc99cc">1</span><span class="token punctuation" style="color:#f2f0ec">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d3d0c8"><span class="token plain">  </span><span class="token number" style="color:#cc99cc">2</span><span class="token punctuation" style="color:#f2f0ec">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d3d0c8"><span class="token plain">  </span><span class="token string" style="color:#cc99cc">&quot;profile_0020...&quot;</span><span class="token punctuation" style="color:#f2f0ec">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d3d0c8"><span class="token plain">  </span><span class="token punctuation" style="color:#f2f0ec">[</span><span class="token string" style="color:#cc99cc">&quot;0020...&quot;</span><span class="token punctuation" style="color:#f2f0ec">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d3d0c8"><span class="token plain"></span><span class="token punctuation" style="color:#f2f0ec">]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Let‚Äôs look a little closer at this <code>previous</code> field: It is an array which contains a Hash string again. The Hash itself is the Id of the Operation we saw last, but why does it need to be an array of them?</p><p>Here it gets really interesting and we might even talk a little bit about graphs.</p><div class="theme-admonition theme-admonition-tip alert alert--success admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><span class="panda-icon">üêª‚Äç‚ùÑÔ∏è</span></span>What is a Graph?</div><div class="admonitionContent_S0QG"><p>Graphs are structures made of <a href="https://en.wikipedia.org/wiki/Graph_(discrete_mathematics)" target="_blank" rel="noopener noreferrer">vertices and edges</a>. You can probably imagine many graphs in your daily life: Public traffic networks are graphs, your family tree is a graph and a network of connected computers is a graph! When we say Graphs we usually mean a more abstract / mathematical idea of them, but still it helps us a lot to solve cool problems: For example finding the <a href="https://en.wikipedia.org/wiki/Dijkstra%27s_algorithm" target="_blank" rel="noopener noreferrer">shortest path</a> between two points inside of it.</p></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="operation-graphs">Operation Graphs<a class="hash-link" href="#operation-graphs" title="Direct link to heading">‚Äã</a></h2><p>In our above example Penguin and Elephant behaved very well: They applied their changes correctly after each other. But what if Elephant would have applied its change at the same point as Penguin? We are back at square one.</p><div class="image-frame_fg61"><div class="image-frame-inner_Xabn"><div style="background-size:cover;background-repeat:no-repeat;position:relative;background-image:url(&quot;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAGCAYAAAD68A/GAAAACXBIWXMAAAsTAAALEwEAmpwYAAABAUlEQVQImQH2AAn/APDz9oLw8/W/4OTntd3h5Lfh5em28PT2u/H09qTN5+cIACQAAEu9sgIA8fT2vvP29//q7fP/5unu/+fq7P/19/n/8PT28f///wQ8u64ABKaWAADt8fO07fDx/+rs9vnw8ff8+/z8+sLDxP/c2dvcXMS8NBqekl4gr6E1AO7w8bXn6On/9/j4++7y8/7s7/L92d7f//vy9dMwtahxGKuc8RutnpgA4OLkt9TV1f/q7Pb+7/H3//Hy8v/p6ur/5ujq5+3//wwANQ4CPbGmBADx9Pas8vX3/Ozv9e/u8fXx9vj68ODh4vfk5ujZ////CJTg2gAAY0YAmia6iN7tnAoAAAAASUVORK5CYII=&quot;)"><svg style="width:100%;height:auto;max-width:100%;margin-bottom:-4px" width="1742" height="1084"></svg><noscript><img style="width:100%;height:auto;max-width:100%;margin-bottom:-4px;position:absolute;top:0;left:0" src="/assets/ideal-img/concurrent-updates.5b90874.1742.png" srcset="/assets/ideal-img/concurrent-updates.5b90874.1742.png 1742w" alt="Concurrent updates by Penguin and Elephant" width="1742" height="1084"></noscript></div></div><div class="image-frame-title_UNlE">Concurrent updates by Penguin and Elephant</div></div><p>We end up with a situation where our Document suddenly has two different ends!</p><div class="theme-admonition theme-admonition-tip alert alert--success admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><span class="panda-icon">üêª‚Äç‚ùÑÔ∏è</span></span>Look!</div><div class="admonitionContent_S0QG"><p>That‚Äôs a graph with three vertices <code>A</code>, <code>B</code>, <code>C</code> and two edges (the two <code>previous</code> links)!</p></div></div><p>Both Penguin and Elephant edited the document <em>at the same time</em>! We can even proof it with the <code>previous</code> fields both pointing at Document View <code>A</code>!</p><div class="theme-admonition theme-admonition-info alert alert--info admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><span class="panda-icon">üêº</span></span>Time Philosophy</div><div class="admonitionContent_S0QG"><p>Not time in the sense of ‚è∞ <code>11:34:58</code>, but more in üî¢ <em>causal order</em></p></div></div><p>What is the state of the Document now? Does it contain <code>My name is: ‚ÄúPenguin‚Äù</code> or <code>My name is: ‚ÄúElephant‚Äù</code> if we request the latest version?</p><p>This situation we call a <strong>Merge Conflict</strong>. It occurs when two users edit the same Operation Field at the same time. To resolve it we need a <strong>Conflict Resolution</strong> strategy and it is actually fairly simple: In p2panda we simply let the Operation win with the higher Operation Id!</p><div class="image-frame_fg61"><div class="image-frame-inner_Xabn"><div style="background-size:cover;background-repeat:no-repeat;position:relative;background-image:url(&quot;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAGCAYAAAD68A/GAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA+klEQVQImRXOSUrDYBQA4IcFDyC4URe69ga5gDcQ172C91BcdOGuIijoInXVgq404EINarUOrUP+EGOGJv+Ul5iBJ73AxwdcY0dodFw/eJ447ssH80Zc47vC4u4zjBeJCNrWeQu4wr7QSKnMKU4UBXFCUmc0FaomooXNywG0jjoAidBmlHKKplnJZd5UdVNfWRbZN7fRztvIWNnf3Vo3Dw1IuDB/fJ8QizKVqg4TXrEgpCor2MbF2fZa70Ctmt0TcD2///g0nIkkVEEKkX4ZI+eb1QHRMgDMGafdeZBZsafzv7HQaKcSH7Bs7r1Xe/g1GV/PjseeB7AE8A9kKr4TU9sSFgAAAABJRU5ErkJggg==&quot;)"><svg style="width:100%;height:auto;max-width:100%;margin-bottom:-4px" width="1690" height="1084"></svg><noscript><img style="width:100%;height:auto;max-width:100%;margin-bottom:-4px;position:absolute;top:0;left:0" src="/assets/ideal-img/conflict-resolution.627dd78.1690.png" srcset="/assets/ideal-img/conflict-resolution.627dd78.1690.png 1690w" alt="Conflict Resolution with resulting Document" width="1690" height="1084"></noscript></div></div><div class="image-frame-title_UNlE">Conflict Resolution with resulting Document</div></div><p>In our example the Operation Id <code>C</code> is higher than the one of Operation Id <code>B</code>. So the Elephant will win! The good thing about this solution is also that all nodes which will see these Operations will decide for the same outcome. This makes the Conflict Resolution Strategy <em>deterministic</em>.</p><p>Is this fair? Since Operation Ids are based on Entry Hashes which are unique it is randomly decided who will win. This is maybe arbitrary but more fair than sorting the winner by timestamp, since you would be able to make up a higher timestamp in a decentralised protocol.</p><p>With these features we made Operations a <strong>Conflict-free Replicated Data Type (CRDT)</strong>. That means: We can make updates on arbitrary documents but never have to worry about merge conflicts which will make the whole system fail. With these two simple rules we can already solve it: 1. Operations are ordered in an Operation Graph based on their <code>previous</code> fields 2. Conflicting updates on the same Operation Field are won by the Operation with the higher Operation Id.</p><div class="theme-admonition theme-admonition-tip alert alert--success admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><span class="panda-icon">üêª‚Äç‚ùÑÔ∏è</span></span>Two simple rules to make a CRDT</div><div class="admonitionContent_S0QG"><p>There is a lot of theory around <a href="https://en.wikipedia.org/wiki/Conflict-free_replicated_data_type" target="_blank" rel="noopener noreferrer">CRDTs</a>, but really, it&#x27;s basically these two rules you need to define to get one: How do you order data and what is the rule when something conflicts?</p></div></div><div class="theme-admonition theme-admonition-tip alert alert--success admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><span class="panda-icon">üêª‚Äç‚ùÑÔ∏è</span></span>Materialisation</div><div class="admonitionContent_S0QG"><p>Do you wonder what the cool algorithm is which <em>reconciles</em> and <em>reduces</em> the operation graph in the way we just described? If you get up in the morning and you are tired, you might be too slow to remember if you need to put your socks or underpants or pants or shirt or pullover on first. With <a href="https://en.wikipedia.org/wiki/Topological_sorting" target="_blank" rel="noopener noreferrer">Topological Sorting</a> we can sort <em>Dependency Graphs</em> in a way where they will tell us what we have to do first before: Your socks are not dependent on anything, you can put them on whenever, but you should put on your underpants before you put on your pants for example! This is exactly what p2panda does: We traverse the operation graph with a Topological Sorting algorithm, bringing all operations into one ordered list, based on their dependencies. Where do we get the dependencies from? The <code>previous</code> links of course!</p></div></div><p>We have missed out on one initial point though which actually was the reason why we started this section: Why is <code>previous</code> an array field? Let‚Äôs imagine there is someone new who wants to apply an UPDATE Operation on the Document. Where would this user apply this update to? On the Penguin Document View or the Elephant Document View? The correct answer would be: On both of them, because this is the latest state of the Operation Graph, and for this we need an array.</p><div class="image-frame_fg61"><div class="image-frame-inner_Xabn"><div style="background-size:cover;background-repeat:no-repeat;position:relative;background-image:url(&quot;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAFCAYAAAB8ZH1oAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAzUlEQVQImRXMPUtCYRQA4PNHXBqU1v6AQ/06FyejQIzQIRAJXVqCQA2vVHIbXEMt83683+e8771chyMOz/qApdBxvviw5KfK+blBP/9N0unuP/1UFu9emQGGLQCDfmkosNRnho0rOBXIyiJbCl9NuYar2QRAaPOWC8UUjuX+cKikxipXoRRSs0b/3hj2buvPj2342Wyi7e6PLVac5YItFpxkyHEcn9fVxWRwUxs9XIN2dK8cxZbKRZLlkXYUSUOLfZJ+O190L1+eoD7uwwlThqQU87LXhgAAAABJRU5ErkJggg==&quot;)"><svg style="width:100%;height:auto;max-width:100%;margin-bottom:-4px" width="2170" height="1084"></svg><noscript><img style="width:100%;height:auto;max-width:100%;margin-bottom:-4px;position:absolute;top:0;left:0" src="/assets/ideal-img/merging.601a6e9.2170.png" srcset="/assets/ideal-img/merging.601a6e9.2170.png 2170w" alt="Merging two Operation Graph Branches into one" width="2170" height="1084"></noscript></div></div><div class="image-frame-title_UNlE">Merging two Operation Graph Branches into one</div></div><p>This new animal in town creates a new Operation with Id <code>D</code> and relates to both Operation <code>B</code> and <code>C</code> in its <code>previous</code> field. We call this a <strong>Merge</strong>.</p><p>We can use a Merge as a strategy to <em>manually</em> resolve a Merge Conflict. But it‚Äôs not like this is their only purpose. It is also just describing your perspective on the Document: In the moment you wanted to make an update you have been aware that there were two concurrent changes being made before and you just wanted to note that.</p><p>As already mentioned, solving Merge Conflicts is only important when we write to the same Operation Field, if we‚Äôre concurrently writing to different fields then we also don‚Äôt have a conflict. Let‚Äôs look at this example:</p><div class="image-frame_fg61"><div class="image-frame-inner_Xabn"><div style="background-size:cover;background-repeat:no-repeat;position:relative;background-image:url(&quot;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAECAYAAAC3OK7NAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAr0lEQVQImQGkAFv/APj5+i74+flF7u36JfHy+Gf29/jG/v3+lvP0+X329/jQ+vr7pf///wUA7vDzwu3w8f/x8fq98PH7Uvj5+Zv9/f189fX5LfLw8kb///80ADgkAAD29/gw+/z7Rvr4/ybw8fhg9fb3t/v8/JZAoaMABZqLhhemmNYbrJ2iAPT19wD5+voA+vn/ALm95gDPzdMA//7/AAB5YQAhqZx9IaqdwRqsnYs0NnK72DyP9QAAAABJRU5ErkJggg==&quot;)"><svg style="width:100%;height:auto;max-width:100%;margin-bottom:-4px" width="2188" height="846"></svg><noscript><img style="width:100%;height:auto;max-width:100%;margin-bottom:-4px;position:absolute;top:0;left:0" src="/assets/ideal-img/concurrent-writes.b69d340.2188.png" srcset="/assets/ideal-img/concurrent-writes.b69d340.2188.png 2188w" alt="Concurrent writes to different Operation Fields" width="2188" height="846"></noscript></div></div><div class="image-frame-title_UNlE">Concurrent writes to different Operation Fields</div></div><p>We can see that Operation Graphs are quite powerful. In a way we can see them as a tool which helps us to describe what we knew about the world when we decided something. In p2panda these views can be quite different: Some users might have been applying changes for weeks without connection to the internet. As soon as they went back online and <em>synced up</em> their changes with the others, we can see in the Operation Graph that a lot happened while the offline user made all of these changes. But this is not a problem, thanks to CRDTs.</p></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/learn/entries"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Bamboo Entries</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/learn/networks"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Networks</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#operation-actions" class="table-of-contents__link toc-highlight">Operation Actions</a></li><li><a href="#documents" class="table-of-contents__link toc-highlight">Documents</a></li><li><a href="#operation-fields" class="table-of-contents__link toc-highlight">Operation Fields</a></li><li><a href="#operation-field-types" class="table-of-contents__link toc-highlight">Operation Field Types</a></li><li><a href="#schema" class="table-of-contents__link toc-highlight">Schema</a></li><li><a href="#encoding" class="table-of-contents__link toc-highlight">Encoding</a></li><li><a href="#operation-id" class="table-of-contents__link toc-highlight">Operation Id</a></li><li><a href="#document-id" class="table-of-contents__link toc-highlight">Document Id</a></li><li><a href="#document-views" class="table-of-contents__link toc-highlight">Document Views</a></li><li><a href="#operation-graphs" class="table-of-contents__link toc-highlight">Operation Graphs</a></li></ul></div></div></div></div></main></div></div><footer class="footer_J6tW"><img class="footer-img__0Xc" src="/images/deepsea-panda.svg" width="100"><div><img class="supporters-img_P2oV" src="/images/nlnet-logo.svg" width="140"><img class="supporters-img_P2oV" src="/images/ngi-logo.png" width="200"><img class="supporters-img_P2oV" src="/images/eu-flag-logo.png" width="78"><p class="footer-text_MXRq">This project has received funding from the European Union‚Äôs Horizon 2020 research and innovation programme within the framework of the NGI-POINTER Project funded under grant agreement No 871528</p></div><p class="footer-text_MXRq">CC BY-SA 4.0<!-- --> - <a href="mailto:contributors@p2panda.org">Contact</a></p></footer></div>
<script src="/assets/js/runtime~main.15fccfd6.js"></script>
<script src="/assets/js/main.125a03bc.js"></script>
</body>
</html>