(self.webpackChunkhandbook=self.webpackChunkhandbook||[]).push([[4902],{2815:(e,t,a)=>{e.exports={src:{srcSet:a.p+"assets/ideal-img/client-and-node-at-a-party.ab1678c.1516.png 1516w",images:[{path:a.p+"assets/ideal-img/client-and-node-at-a-party.ab1678c.1516.png",width:1516,height:892}],src:a.p+"assets/ideal-img/client-and-node-at-a-party.ab1678c.1516.png",toString:function(){return a.p+"assets/ideal-img/client-and-node-at-a-party.ab1678c.1516.png"},placeholder:void 0,width:1516,height:892},preSrc:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAGCAYAAAD68A/GAAAACXBIWXMAAAsTAAALEwEAmpwYAAABAUlEQVQImQH2AAn/APeOwwL4j8MA7I7ADvqNwz31i8Fl1YrGCfGLwhn3j8Qw+YvCG/eKwAAA9ZHEAPWUxhX/hMUo/4TAIf+FwUf/ibci/4azDvqJv1b2iMA+94nAEAAA7JUB/4XFXXidraECs5vFPKWnPl6H1ckqiNiXxJLQAPaNwkj2icBTAOiPwCb/dM4ZVqOoeCOuoPtZnqZUMIfbzlGK1M7/jLwd9InASPSHvjkA94vBUvaIwFD/gsgbzIq2HP+Kw1rdgboZ/4m9J/yKwIX0icAu/Wq2AADUeKYC/6HWAOiKvA//hOkD8oi+Pv+KvhT4icAi53y3EPSCtQP7ebsB3SKMjw/GVfQAAAAASUVORK5CYII="}},926:(e,t,a)=>{e.exports={src:{srcSet:a.p+"assets/ideal-img/network-topologies.2920ef5.2754.png 2754w",images:[{path:a.p+"assets/ideal-img/network-topologies.2920ef5.2754.png",width:2754,height:1348}],src:a.p+"assets/ideal-img/network-topologies.2920ef5.2754.png",toString:function(){return a.p+"assets/ideal-img/network-topologies.2920ef5.2754.png"},placeholder:void 0,width:2754,height:1348},preSrc:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAFCAYAAAB8ZH1oAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA2ElEQVQImQHNADL/AAD//wAgoZAAJJyRLiORkCcomaglI6maUwIADwQlbnMNDwAAACg5RAAAKVBcBxwAAAIjl4EpIqSqWTmJ01V2gIUSKaiaURt9aRMzAAYJJ0VNCgAAAAAAQ3O8Cz2WoyMsq5c9NIjMHzWI1kVNjscnLp65ey+KSAsnAC8CACyRywA1k9BHLaKxbiOvmEQhpaoRJKahRiehpjAxo7E0I+aqBSSTegAAICs/AjFBSBAzZmYaK46KDBH//wAqfXMVI3hqDiekrwAm8ZIAI5d4ABg6QRZp8jDiAAAAAElFTkSuQmCC"}},7052:(e,t,a)=>{e.exports={src:{srcSet:a.p+"assets/ideal-img/typical-conversation-between-two-nodes.a14426a.1322.png 1322w",images:[{path:a.p+"assets/ideal-img/typical-conversation-between-two-nodes.a14426a.1322.png",width:1322,height:1132}],src:a.p+"assets/ideal-img/typical-conversation-between-two-nodes.a14426a.1322.png",toString:function(){return a.p+"assets/ideal-img/typical-conversation-between-two-nodes.a14426a.1322.png"},placeholder:void 0,width:1322,height:1132},preSrc:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAICAYAAADA+m62AAAACXBIWXMAAAsTAAALEwEAmpwYAAABL0lEQVQYlS2Pz0oCQRzHf4i4qxfxGbw4axvujparRZeYFBKJuidaGOqydRARXciolpl5heiQvUYn6RoU7ewu9S4Tu3T9fj98/4DBojlmwQreJGidSbZUJwqyiIo6k2ys1bi4NVi0hAoNeiYVQ3iRUD6bZUp1kkYWSaOTqQJrCZj6FxUaDMBk4azGxR18Sige9nNao6WUmy2lSC5z8J4kugYLFzE4xEw4+EuCdjxWkUUyqE4yqOuoZiihynzbYOEIDBqMTOrfVD+SjSqyjv7BaxV/J9WOQUMbTB5N48FSAjj8Nb+1185qjZZqs3Ue7KR6YfJoDronznVPDHT2A9vuJoUOTgHtd0F3Nymd/cZ+T/dEHzCP3B0uPAkA48fnQrnZjg/lru6fCrG2y/0HzKPVH/3eeUkg9tDrAAAAAElFTkSuQmCC"}},2233:(e,t,a)=>{"use strict";a.d(t,{Z:()=>l});var n=a(7294),o=a(5944);const i="image-frame_fg61",r="image-frame-inner_Xabn",s="image-frame-title_UNlE";function l(e){let{title:t,url:a}=e;return a?n.createElement("div",{className:i},n.createElement("div",{className:r},n.createElement(o.Z,{alt:t,title:t,img:a})),t&&n.createElement("div",{className:s},t)):null}},5676:(e,t,a)=>{"use strict";a.r(t),a.d(t,{assets:()=>p,contentTitle:()=>s,default:()=>m,frontMatter:()=>r,metadata:()=>l,toc:()=>d});var n=a(7462),o=(a(7294),a(4137)),i=a(2233);const r={title:"Networks"},s=void 0,l={unversionedId:"learn/networks",id:"learn/networks",title:"Networks",description:"In p2panda we need at least two participants to call it a party: We need a Client and a Node. Okay, they don\u2019t sound like the most fun party guests, but we promise you, they are cool!",source:"@site/docs/learn/networks.md",sourceDirName:"learn",slug:"/learn/networks",permalink:"/learn/networks",draft:!1,tags:[],version:"current",frontMatter:{title:"Networks"},sidebar:"learn",previous:{title:"Operations and Documents",permalink:"/learn/operations"}},p={},d=[{value:"Clients",id:"clients",level:2},{value:"Reading",id:"reading",level:3},{value:"Writing",id:"writing",level:3},{value:"Nodes",id:"nodes",level:2},{value:"Validation",id:"validation",level:3},{value:"Persistence",id:"persistence",level:3},{value:"Materialisation",id:"materialisation",level:3},{value:"Discovery",id:"discovery",level:3},{value:"Replication",id:"replication",level:3},{value:"Decentralisation &amp; Federation",id:"decentralisation--federation",level:2}],h={toc:d};function m(e){let{components:t,...r}=e;return(0,o.kt)("wrapper",(0,n.Z)({},h,r,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("p",null,"In p2panda we need at least two participants to call it a party: We need a ",(0,o.kt)("strong",{parentName:"p"},"Client")," and a ",(0,o.kt)("strong",{parentName:"p"},"Node"),". Okay, they don\u2019t sound like the most fun party guests, but we promise you, they are cool!"),(0,o.kt)(i.Z,{title:"Client and Node at a party",url:a(2815),mdxType:"ImageFrame"}),(0,o.kt)("h2",{id:"clients"},"Clients"),(0,o.kt)("p",null,"Clients are programs which read or write data from Nodes. To write data they need to sign it before, which means that they have to also hold a ",(0,o.kt)("strong",{parentName:"p"},"Private Key")," somewhere safely."),(0,o.kt)("h3",{id:"reading"},"Reading"),(0,o.kt)("p",null,"Reading from them is fairly easy: We just need to send a GraphQL query like that:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-graphql"},"{\n  all_mushroom_0020... {\n    documents {\n      fields {\n        title\n        edible\n        description\n        latin\n      }\n    }\n  }\n}\n")),(0,o.kt)("p",null,"If our Node knows something about ",(0,o.kt)("inlineCode",{parentName:"p"},"mushroom")," Schemas, then we would get a response now. The Client can render the result in a user interface or process that information somehow."),(0,o.kt)("admonition",{title:"Learn more",type:"info"},(0,o.kt)("p",{parentName:"admonition"},"If you haven\u2019t read about Schemas yet, we can recommend reading the previous learn chapter about ",(0,o.kt)("a",{parentName:"p",href:"/learn/operations"},"Operations and Documents"),". Or you might even want to directly ",(0,o.kt)("a",{parentName:"p",href:"/tutorials/send-to-node"},"create your own Schemas")," in the tutorial!")),(0,o.kt)("admonition",{title:"Do not forget the bots",type:"note"},(0,o.kt)("p",{parentName:"admonition"},"Not every Client needs to be used by a human. Clients can also be automated bots which operate in a p2panda network.")),(0,o.kt)("p",null,"This already tells us something important about Clients and Nodes: Nodes are the part of the network which ",(0,o.kt)("em",{parentName:"p"},"store")," the data for us. This is why we can query something from them as Clients!"),(0,o.kt)("h3",{id:"writing"},"Writing"),(0,o.kt)("p",null,"Since the data lives on a Node, we should also send our new data to them, whenever we create something. This again can be done with a GraphQL mutation, for example like that:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-graphql"},"mutation Publish($entry: String!, $operation: String!) {\n  publish(entry: $entry, operation: $operation) {\n    logId\n    seqNum\n    backlink\n    skiplink\n  }\n}\n")),(0,o.kt)("p",null,"We\u2019re sending a Node an ",(0,o.kt)("strong",{parentName:"p"},"Entry")," and ",(0,o.kt)("strong",{parentName:"p"},"Operation"),", these are the essential data types of p2panda."),(0,o.kt)("admonition",{title:"What is this response?",type:"tip"},(0,o.kt)("p",{parentName:"admonition"},"The node optimistically responds to us with data containing ",(0,o.kt)("inlineCode",{parentName:"p"},"logId"),", ",(0,o.kt)("inlineCode",{parentName:"p"},"seqNum"),", ",(0,o.kt)("inlineCode",{parentName:"p"},"backlink")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"skiplink"),", which are arguments we can use to create our next Entry.")),(0,o.kt)("p",null,"Entries need to be signed by a ",(0,o.kt)("strong",{parentName:"p"},"Key Pair")," which only the Client knows about before it is being sent to a Node. This ",(0,o.kt)("strong",{parentName:"p"},"Signature")," proves that the Client was the original creator of this Operation and ensures that it can not be changed afterwards anymore."),(0,o.kt)("admonition",{title:"Learn more",type:"info"},(0,o.kt)("p",{parentName:"admonition"},"You can read everything about Entries, Key Pairs and Signatures in the regarding ",(0,o.kt)("a",{parentName:"p",href:"/learn/entries"},"Bamboo Entry")," learn section. If you\u2019re curious about Operations, then we have you covered with the ",(0,o.kt)("a",{parentName:"p",href:"/learn/operations"},"Operations & Documents")," learn section.")),(0,o.kt)("p",null,"Whenever a Client wants to ",(0,o.kt)("em",{parentName:"p"},"write")," data to a Node, it needs to keep the ",(0,o.kt)("strong",{parentName:"p"},"Private Key")," of the Key Pair safely stored. This is an important trait of Clients: They are the ",(0,o.kt)("em",{parentName:"p"},"holders")," of a private key. Nodes will never know about them!"),(0,o.kt)("h2",{id:"nodes"},"Nodes"),(0,o.kt)("p",null,"Nodes do much more than Clients! They are the actual participants in the network, validate the data, store it, materialise it, find other nodes to distribute the data even further."),(0,o.kt)("h3",{id:"validation"},"Validation"),(0,o.kt)("p",null,"Every Node checks the Entry and Operation the Client signed, encoded and sent to it. It validates a couple of things:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Was the Entry and Operation correctly formatted?"),(0,o.kt)("li",{parentName:"ul"},"Is the Signature of the Entry valid?"),(0,o.kt)("li",{parentName:"ul"},"Does the Operation really belong to this Entry?"),(0,o.kt)("li",{parentName:"ul"},"Did the Operation fulfil the claimed Schema?"),(0,o.kt)("li",{parentName:"ul"},".. and much more!")),(0,o.kt)("h3",{id:"persistence"},"Persistence"),(0,o.kt)("p",null,"After all the data has been checked it finally can be stored in the database of the Node. Nodes are the ",(0,o.kt)("strong",{parentName:"p"},"Persistence "),"layers of the p2panda network."),(0,o.kt)("admonition",{title:"Database-agnostic specification",type:"info"},(0,o.kt)("p",{parentName:"admonition"},"The p2panda specification does not prescribe ",(0,o.kt)("em",{parentName:"p"},"how")," you want to store the data. In our reference implementation ",(0,o.kt)("inlineCode",{parentName:"p"},"aquadoggo")," we\u2019re using PostgreSQL or SQLite, but you could also take something else if you want to build your own Node.")),(0,o.kt)("h3",{id:"materialisation"},"Materialisation"),(0,o.kt)("p",null,"The data the Node received and stored from the Client is still in a very raw form and needs to be processed. We did not query Operations but Mushrooms in your example above! "),(0,o.kt)("p",null,"Operations just describe ",(0,o.kt)("em",{parentName:"p"},"changes")," of data but not the final state of the data in the end. These final results we call ",(0,o.kt)("strong",{parentName:"p"},"Documents"),". This is also the data we want to query as a client. But first our Node needs to prepare them to look like that!"),(0,o.kt)("p",null,"To get from raw Operations to Documents, we apply ",(0,o.kt)("strong",{parentName:"p"},"Materialisation"),". This is where the heavy work begins: Nodes need to look at all Operations which form Documents together, run the Materialisation algorithm and store that state in the database again."),(0,o.kt)("admonition",{title:"Thank you for your hard work",type:"info"},(0,o.kt)("p",{parentName:"admonition"},"This is one of the main reasons why p2panda separates Clients from Nodes: Materialisation can take time and resources from your computer and especially in Browsers it might get slow. If we separate the processes from each other we get a lightweight, fast Client (and a happy Human using it) and move the work into the ",(0,o.kt)("em",{parentName:"p"},"background")," to the Node.")),(0,o.kt)("h3",{id:"discovery"},"Discovery"),(0,o.kt)("p",null,"Nodes are so cool, they can do even more! They walk around during the party and try to see if there are other Nodes hanging around."),(0,o.kt)("p",null,"This process we call ",(0,o.kt)("strong",{parentName:"p"},"Discovery"),", it basically means that Nodes try to find other Nodes inside of the network."),(0,o.kt)("admonition",{title:"Can someone please fix the internet?",type:"tip"},(0,o.kt)("p",{parentName:"admonition"},"Discovery is quite tricky and one of the main challenges for p2p networks. The reason for this is that the internet has grown faster than expected, leading to a shortage of IPv4 addresses. Usually our smartphones, laptops, computers, etc. are all connected to the local WiFi network - but that would mean that each of them would need to get an unique IP address, and these are very rare! To circumvent that problem ",(0,o.kt)("a",{parentName:"p",href:"https://tailscale.com/blog/how-nat-traversal-works/"},"NAT traversal")," mechanisms have been invented which translate one ",(0,o.kt)("em",{parentName:"p"},"global")," IP address to multiple ones in your local network. Because of this translation it is hard to find out from the outside how we can connect to that smartphone behind the NAT. At the end of the day, we want to build a ",(0,o.kt)("em",{parentName:"p"},"peer-to-peer")," network, we want to ",(0,o.kt)("em",{parentName:"p"},"directly")," connect to that device!")),(0,o.kt)("p",null,"There are different techniques to achieve this, on a local network we can simply just ",(0,o.kt)("em",{parentName:"p"},"broadcast")," a message and say something like: \u201cHello, I\u2019m a Node and I\u2019m here\u201d. Other Nodes will pick these messages up and learn about that Node. That would be the equivalent of screaming every 2 seconds at a party, telling everyone else that we\u2019re still there. Sounds quite annoying, but it works! This technique is called ",(0,o.kt)("strong",{parentName:"p"},"mDNS"),", or ",(0,o.kt)("a",{parentName:"p",href:"https://en.wikipedia.org/wiki/Multicast_DNS"},"Multicast DNS"),"."),(0,o.kt)("p",null,"If we\u2019re leaving the local network and we still want to discover other Nodes it gets a little more tricky. Usually we can solve this with some sort of dedicated ",(0,o.kt)("strong",{parentName:"p"},"Signalling")," server (or a couple of them), which help us to announce that our Node entered the network. Other Nodes can look these announcements up by calling that server. We can think about them a little bit like telephone books where we can look up phone numbers."),(0,o.kt)("p",null,"Another technique of getting to know some other Nodes at a party is to enter it with already knowing one Node friend who will be there. That Node friend can tell you about the other friends they know about. If you continue asking all friends about ",(0,o.kt)("em",{parentName:"p"},"their")," regarding friends you will probably end up with knowing all Nodes at the party. This approach is based on a ",(0,o.kt)("strong",{parentName:"p"},"Gossip Protocol")," and does not need a central server. But you need to know someone already before you enter the party!"),(0,o.kt)("admonition",{title:"What discovery protocol do we use?",type:"info"},(0,o.kt)("p",{parentName:"admonition"},"Which technique does p2panda have? We haven\u2019t implemented one yet, but one thing is clear: We want you to pick the one which you think is best as they all have advantages and disadvantages and most of all, different social implications!")),(0,o.kt)("h3",{id:"replication"},"Replication"),(0,o.kt)("p",null,"Okay, but now back to our Node! What do Nodes do when they finally meet each other? They start ",(0,o.kt)("strong",{parentName:"p"},"Replication"),"! This is the process of sharing the data they know about."),(0,o.kt)(i.Z,{title:"A typical conversation between two Nodes",url:a(7052),mdxType:"ImageFrame"}),(0,o.kt)("p",null,"Replication makes sure that data spreads across the decentralised network. This means that not all Nodes know ",(0,o.kt)("em",{parentName:"p"},"everything")," at ",(0,o.kt)("em",{parentName:"p"},"the same time"),". They might only get to know some data later, or maybe never! This makes p2panda an ",(0,o.kt)("strong",{parentName:"p"},"Eventually Consistent Database"),"."),(0,o.kt)("admonition",{title:"What replication protocol do we use?",type:"tip"},(0,o.kt)("p",{parentName:"admonition"},"@TODO")),(0,o.kt)("h2",{id:"decentralisation--federation"},"Decentralisation & Federation"),(0,o.kt)("p",null,"We\u2019ve seen now the relationship between Clients and Nodes. Clients are the ",(0,o.kt)("em",{parentName:"p"},"creators")," and ",(0,o.kt)("em",{parentName:"p"},"consumers")," of data while Nodes take care of the rest."),(0,o.kt)("p",null,"Since Clients only need to talk via GraphQL to a Node they can be easily implemented without much effort. "),(0,o.kt)("p",null,"We can now imagine all sorts of clients: An ",(0,o.kt)("a",{parentName:"p",href:"/tutorials/mushroom-app"},"mushrooming app"),", a ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/p2panda/zoo-adventures"},"computer game")," or a cool ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/p2panda/festival-tool"},"festival tool")," to set up events. They can run as web applications in the browser or can be implemented as native applications, also running on mobile phones."),(0,o.kt)("p",null,"But how do we implement a Node? The good news is: There is already one reference implementation called ",(0,o.kt)("a",{parentName:"p",href:"/tutorials/aquadoggo"},(0,o.kt)("inlineCode",{parentName:"a"},"aquadoggo")),"and since Nodes are ",(0,o.kt)("em",{parentName:"p"},"agnostic")," to the data they process, you probably can just use this one. It gets even better: Nodes can support all sorts of applications as long as they know about the Schema the application needs!"),(0,o.kt)("p",null,"This gives us quite many options now on how to deal with the Node: We can host it on a server on the internet and simply just allow many clients to talk to it. This is what we would call a ",(0,o.kt)("strong",{parentName:"p"},"Federated Node"),". It is a Node shared with many clients."),(0,o.kt)("p",null,"We could also host the Node directly on our computer, for example just as a running program, or even a ",(0,o.kt)("a",{parentName:"p",href:"https://en.wikipedia.org/wiki/Daemon_(computing)"},"background process")," which automatically launches as soon as we\u2019ve started our computer. This is what we would call a ",(0,o.kt)("strong",{parentName:"p"},"Decentralised Node "),"as it is not shared and runs ",(0,o.kt)("em",{parentName:"p"},"locally")," on your device. But this would require you to understand quite a bit about computers and we can\u2019t assume that everyone will do the same."),(0,o.kt)("p",null,"We can also ",(0,o.kt)("em",{parentName:"p"},"embed")," the Node directly next to the Client and ship it all bundled in one program! This is the ",(0,o.kt)("em",{parentName:"p"},"easiest")," method for the users, as they can just install the application and will get a Node for free without worrying too much about it."),(0,o.kt)("admonition",{title:"Container with web view",type:"tip"},(0,o.kt)("p",{parentName:"admonition"},"With cool frameworks like ",(0,o.kt)("a",{parentName:"p",href:"https://tauri.app/"},"Tauri")," we can easily embed ",(0,o.kt)("inlineCode",{parentName:"p"},"aquadoggo")," and have a JavaScript web view Client in front of it.")),(0,o.kt)("p",null,"For whatever ",(0,o.kt)("strong",{parentName:"p"},"Network Topology")," you decide: All Nodes will always be able to communicate to each other whenever they want to. It does not matter if you decided to host yours in a federated or decentralised manner."),(0,o.kt)(i.Z,{title:"Different network topologies with federated or decentralised Nodes",url:a(926),mdxType:"ImageFrame"}),(0,o.kt)("p",null,"Similar to the Replication and Discovery, deciding on an approach has different implications: Sharing a Node with others comes with much more responsibility but easier access. Users can just open a website and directly interact with the p2panda network! Having your own local node is practical if you want to be able to be ",(0,o.kt)("em",{parentName:"p"},"offline")," and still use your Client. Also you will have your data in exactly your place."))}m.isMDXComponent=!0}}]);