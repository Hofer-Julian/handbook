"use strict";(self.webpackChunkhandbook=self.webpackChunkhandbook||[]).push([[8651],{7015:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>a,contentTitle:()=>o,default:()=>h,frontMatter:()=>r,metadata:()=>l,toc:()=>d});var t=i(5893),s=i(1151);const r={id:"publishing",title:"Publishing"},o=void 0,l={id:"specification/APIs/publishing",title:"Publishing",description:"- Clients use two GraphQL operations for publishing entries:",source:"@site/docs/specification/APIs/publishing.md",sourceDirName:"specification/APIs",slug:"/specification/APIs/publishing",permalink:"/specification/APIs/publishing",draft:!1,unlisted:!1,tags:[],version:"current",frontMatter:{id:"publishing",title:"Publishing"},sidebar:"specification",previous:{title:"Overview",permalink:"/specification/APIs/overview"},next:{title:"Queries",permalink:"/specification/APIs/queries"}},a={},d=[{value:"<code>nextArgs</code>",id:"nextargs",level:2},{value:"<code>publish</code>",id:"publish",level:2},{value:"Response",id:"response",level:2}];function c(e){const n={a:"a",code:"code",em:"em",h2:"h2",li:"li",ol:"ol",pre:"pre",ul:"ul",...(0,s.a)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Clients use two GraphQL operations for publishing entries:","\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"#nextargs",children:(0,t.jsx)(n.code,{children:"nextArgs"})})," query to retrieve parameters required for encoding an entry"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"#publish",children:(0,t.jsx)(n.code,{children:"publish"})})," mutation to publish a signed and encoded entry together with its payload"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"nextargs",children:(0,t.jsx)(n.code,{children:"nextArgs"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Returns parameters required for encoding new entries","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Implementations must not have side effects"}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["Clients can't encode new entries without information from this endpoint because every entry needs to place itself in the first unused sequence number of a specific ",(0,t.jsx)(n.a,{href:"/specification/data-types/bamboo",children:(0,t.jsx)(n.em,{children:"Bamboo log"})})," and also it needs to include the hashes of specific previous entries in its encoding","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"This information is held by the node"}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["Clients may cache the arguments required for the next entry (they are also returned by ",(0,t.jsx)(n.code,{children:"publish"}),")"]}),"\n",(0,t.jsx)(n.li,{children:"Clients may also persist their entry logs locally to avoid any dependency for retrieving entry arguments of nodes at all"}),"\n",(0,t.jsxs)(n.li,{children:["Clients must set the ",(0,t.jsx)(n.code,{children:"viewId"})," input variable to receive arguments for encoding an ",(0,t.jsx)(n.code,{children:"UPDATE"})," or ",(0,t.jsx)(n.code,{children:"DELETE"})," operation.","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Clients must not set this when they want to encode a ",(0,t.jsx)(n.code,{children:"CREATE"})," operation"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-graphql",children:'query nextArgs(\n  """\n  public key of the author signing and encoding the next entry\n  """\n  publicKey: PublicKey!\n\n  """\n  any view id from the document that will be updated or deleted with the next entry. leave empty to receive arguments for creating a new document.\n  """\n  viewId: ViewId\n): NextArguments!\n'})}),"\n",(0,t.jsx)(n.h2,{id:"publish",children:(0,t.jsx)(n.code,{children:"publish"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["If a ",(0,t.jsx)(n.code,{children:"publish"})," request is accepted by a node it must publish the entry supplied with the request by taking the following steps:","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["The node must validate the received entry and operation by checking if:","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["The entry adheres to the ",(0,t.jsx)(n.a,{href:"/specification/data-types/bamboo",children:"bamboo specification"})," and has a valid signature and log integrity"]}),"\n",(0,t.jsxs)(n.li,{children:["The operation adheres to the ",(0,t.jsx)(n.a,{href:"/specification/data-types/operations",children:"operation specification"})]}),"\n",(0,t.jsx)(n.li,{children:"The operation is linked to the entry with a correct payload hash and size"}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.li,{children:"The node should persist the entry and operation and make it available to other nodes for replication"}),"\n",(0,t.jsxs)(n.li,{children:["The node may ",(0,t.jsx)(n.a,{href:"/specification/data-types/documents#reduction",children:"materialise"})," the document this new operation belongs to, resulting in a new document view"]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["Returns entry arguments required for publishing the next entry for the same document, similar to ",(0,t.jsx)(n.code,{children:"nextArgs"})]}),"\n",(0,t.jsxs)(n.li,{children:["Returns an error","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"When the Bamboo log, signature or document integrity could not be verified, the operation was malformed or schema not fulfilled"}),"\n",(0,t.jsx)(n.li,{children:"When the node is unable to persist the entry and operation at the moment"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-graphql",children:'mutation publish(\n  """\n  CBOR representation of a signed Bamboo entry, encoded as a hexadecimal string\n  """\n  entry: EncodedEntry!\n\n  """\n  CBOR representation of an p2panda operation, the payload of the Bamboo entry,\n  encoded as a hexadecimal string\n  """\n  operation: EncodedOperation!\n): NextArguments!\n'})}),"\n",(0,t.jsx)(n.h2,{id:"response",children:"Response"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Both ",(0,t.jsx)(n.code,{children:"publish"})," and ",(0,t.jsx)(n.code,{children:"nextArgs"})," return the arguments for encoding and signing the next entry as a response"]}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-graphql",children:'type NextArguments {\n  """\n  log id to be used to forge the next entry\n  """\n  logId: LogId!\n  \n  """\n  sequence number to be used to forge the next entry\n  """\n  seqNum: SeqNum!\n  \n  """\n  optional backlink hash to be used to forge the next entry\n  """\n  backlink: EntryHash\n  \n  """\n  optional skiplink hash to be used to forge the next entry\n  """\n  skiplink: EntryHash\n}\n'})})]})}function h(e={}){const{wrapper:n}={...(0,s.a)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(c,{...e})}):c(e)}},1151:(e,n,i)=>{i.d(n,{Z:()=>l,a:()=>o});var t=i(7294);const s={},r=t.createContext(s);function o(e){const n=t.useContext(r);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:o(e.components),t.createElement(r.Provider,{value:n},e.children)}}}]);