"use strict";(self.webpackChunkhandbook=self.webpackChunkhandbook||[]).push([[6578],{4137:(e,t,a)=>{a.d(t,{Zo:()=>p,kt:()=>u});var i=a(7294);function n(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function l(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,i)}return a}function r(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?l(Object(a),!0).forEach((function(t){n(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):l(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function m(e,t){if(null==e)return{};var a,i,n=function(e,t){if(null==e)return{};var a,i,n={},l=Object.keys(e);for(i=0;i<l.length;i++)a=l[i],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(i=0;i<l.length;i++)a=l[i],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}var o=i.createContext({}),s=function(e){var t=i.useContext(o),a=t;return e&&(a="function"==typeof e?e(t):r(r({},t),e)),a},p=function(e){var t=s(e.components);return i.createElement(o.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return i.createElement(i.Fragment,{},t)}},c=i.forwardRef((function(e,t){var a=e.components,n=e.mdxType,l=e.originalType,o=e.parentName,p=m(e,["components","mdxType","originalType","parentName"]),c=s(a),u=n,h=c["".concat(o,".").concat(u)]||c[u]||d[u]||l;return a?i.createElement(h,r(r({ref:t},p),{},{components:a})):i.createElement(h,r({ref:t},p))}));function u(e,t){var a=arguments,n=t&&t.mdxType;if("string"==typeof e||n){var l=a.length,r=new Array(l);r[0]=c;var m={};for(var o in t)hasOwnProperty.call(t,o)&&(m[o]=t[o]);m.originalType=e,m.mdxType="string"==typeof e?e:n,r[1]=m;for(var s=2;s<l;s++)r[s]=a[s];return i.createElement.apply(null,r)}return i.createElement.apply(null,a)}c.displayName="MDXCreateElement"},4329:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>o,contentTitle:()=>r,default:()=>d,frontMatter:()=>l,metadata:()=>m,toc:()=>s});var i=a(7462),n=(a(7294),a(4137));const l={id:"schemas",title:"Schemas"},r=void 0,m={unversionedId:"specification/data-types/schemas",id:"specification/data-types/schemas",title:"Schemas",description:"- Schemas are used to describe and validate the format in which data is published",source:"@site/docs/specification/data-types/schemas.md",sourceDirName:"specification/data-types",slug:"/specification/data-types/schemas",permalink:"/specification/data-types/schemas",draft:!1,tags:[],version:"current",frontMatter:{id:"schemas",title:"Schemas"},sidebar:"specification",previous:{title:"Operations",permalink:"/specification/data-types/operations"},next:{title:"Documents",permalink:"/specification/data-types/documents"}},o={},s=[{value:"Fields",id:"fields",level:2},{value:"<em>bool</em> fields",id:"bool-fields",level:3},{value:"<em>int</em> fields",id:"int-fields",level:3},{value:"<em>float</em> fields",id:"float-fields",level:3},{value:"<em>bytes</em> fields",id:"bytes-fields",level:3},{value:"<em>str</em> fields",id:"str-fields",level:3},{value:"<em>relation</em> fields",id:"relation-fields",level:3},{value:"System and Application Schemas",id:"system-and-application-schemas",level:2},{value:"Schema ID",id:"schema-id",level:3},{value:"System Schemas",id:"system-schemas",level:2},{value:"Schema Definition",id:"schema-definition",level:3},{value:"Schema Field Definition",id:"schema-field-definition",level:3}],p={toc:s};function d(e){let{components:t,...a}=e;return(0,n.kt)("wrapper",(0,i.Z)({},p,a,{components:t,mdxType:"MDXLayout"}),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"Schemas are used to describe and validate the format in which data is published"),(0,n.kt)("li",{parentName:"ul"},"Schemas are identified by their ",(0,n.kt)("a",{parentName:"li",href:"#schema-id"},"schema id")),(0,n.kt)("li",{parentName:"ul"},"Schemas have a name, a description and a number of ",(0,n.kt)("em",{parentName:"li"},"fields"))),(0,n.kt)("admonition",{title:"Requirement SC1",type:"caution"},(0,n.kt)("p",{parentName:"admonition"},"The name of a schema MUST match the regular expression ",(0,n.kt)("inlineCode",{parentName:"p"},"^[A-Za-z]{1}[A-Za-z0-9_]{0,62}[A-Za-z0-9]{1}$")),(0,n.kt)("ul",{parentName:"admonition"},(0,n.kt)("li",{parentName:"ul"},"The name of a schema MUST be at most 64 characters long"),(0,n.kt)("li",{parentName:"ul"},"It begins with a letter"),(0,n.kt)("li",{parentName:"ul"},"It uses only alphanumeric characters, digits and the underscore character ( ",(0,n.kt)("inlineCode",{parentName:"li"},"_")," )"),(0,n.kt)("li",{parentName:"ul"},"It doesn't end with an underscore"))),(0,n.kt)("admonition",{title:"Requirement SC2",type:"caution"},(0,n.kt)("p",{parentName:"admonition"},"The description of a schema MUST consist of unicode characters and MUST be at most 256 characters long")),(0,n.kt)("admonition",{title:"Requirement SC3",type:"caution"},(0,n.kt)("p",{parentName:"admonition"},"A schema MUST have at most 1024 fields")),(0,n.kt)("h2",{id:"fields"},"Fields"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"A field is defined by",(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("em",{parentName:"li"},"field name")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("em",{parentName:"li"},"field type"))))),(0,n.kt)("admonition",{title:"Requirement SC4",type:"caution"},(0,n.kt)("p",{parentName:"admonition"},"The field name MUST match the regular expression ",(0,n.kt)("inlineCode",{parentName:"p"},"^[A-Za-z]{1}[A-Za-z0-9_]{0,63}$")),(0,n.kt)("ul",{parentName:"admonition"},(0,n.kt)("li",{parentName:"ul"},"The field name MUST be at most 64 characters long"),(0,n.kt)("li",{parentName:"ul"},"It begins with a letter"),(0,n.kt)("li",{parentName:"ul"},"It uses only alphanumeric characters, digits and the underscore character ( ",(0,n.kt)("inlineCode",{parentName:"li"},"_")," )"))),(0,n.kt)("admonition",{title:"Requirement SC5",type:"caution"},(0,n.kt)("p",{parentName:"admonition"},"The field type MUST be one of:"),(0,n.kt)("ul",{parentName:"admonition"},(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("em",{parentName:"li"},"bool")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("em",{parentName:"li"},"int")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("em",{parentName:"li"},"float")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("em",{parentName:"li"},"bytes")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("em",{parentName:"li"},"str")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("em",{parentName:"li"},"relation")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("em",{parentName:"li"},"relation list")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("em",{parentName:"li"},"pinned relation")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("em",{parentName:"li"},"pinned relation list")))),(0,n.kt)("h3",{id:"bool-fields"},(0,n.kt)("em",{parentName:"h3"},"bool")," fields"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"Encode a boolean value")),(0,n.kt)("h3",{id:"int-fields"},(0,n.kt)("em",{parentName:"h3"},"int")," fields"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"Encode a signed 64 bit integer number")),(0,n.kt)("h3",{id:"float-fields"},(0,n.kt)("em",{parentName:"h3"},"float")," fields"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"Encode a 64 bit floating point number")),(0,n.kt)("h3",{id:"bytes-fields"},(0,n.kt)("em",{parentName:"h3"},"bytes")," fields"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"Encode a bytes (u8) string")),(0,n.kt)("h3",{id:"str-fields"},(0,n.kt)("em",{parentName:"h3"},"str")," fields"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"Encode a text string")),(0,n.kt)("admonition",{title:"Requirement SC6",type:"caution"},(0,n.kt)("p",{parentName:"admonition"},(0,n.kt)("em",{parentName:"p"},"str")," fields MUST use unicode encoding")),(0,n.kt)("h3",{id:"relation-fields"},(0,n.kt)("em",{parentName:"h3"},"relation")," fields"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"Encode a ",(0,n.kt)("em",{parentName:"li"},"relation")," to one or many other ",(0,n.kt)("em",{parentName:"li"},"documents")),(0,n.kt)("li",{parentName:"ul"},"There are four kinds of relation fields",(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},"Relations represent the whole referenced document through their ",(0,n.kt)("em",{parentName:"li"},"document id"),(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("em",{parentName:"li"},"relation"),": reference to a single document"),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("em",{parentName:"li"},"relation list"),": a list of references to documents"))),(0,n.kt)("li",{parentName:"ul"},"Pinned relations point at immutable versions of documents through their ",(0,n.kt)("em",{parentName:"li"},"document view ids"),(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("em",{parentName:"li"},"pinned relation"),": reference to a single document view."),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("em",{parentName:"li"},"pinned relation list"),": a list of references to document views")))))),(0,n.kt)("admonition",{title:"Requirement SC7",type:"caution"},(0,n.kt)("p",{parentName:"admonition"},"All relation fields MUST define a schema that all referenced documents must conform to")),(0,n.kt)("admonition",{title:"Requirement SC8",type:"caution"},(0,n.kt)("p",{parentName:"admonition"},(0,n.kt)("em",{parentName:"p"},"relation")," fields MAY be self-referential in that their target is of the same schema. Self-referential relations MAY be interpreted as document ordering in ",(0,n.kt)("a",{parentName:"p",href:"/specification/APIs/queries"},"queries"))),(0,n.kt)("h2",{id:"system-and-application-schemas"},"System and Application Schemas"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("em",{parentName:"li"},"System schemas")," are defined as part of the p2panda specification",(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},"The format of system schema operations can be validated by their CDDL definitions"))),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("em",{parentName:"li"},"Application schemas")," are published by developers",(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},"They are used to validate the format of application specific data"),(0,n.kt)("li",{parentName:"ul"},"All developers can create new application schemas by publishing documents of the ",(0,n.kt)("inlineCode",{parentName:"li"},"SchemaDefinition")," and ",(0,n.kt)("inlineCode",{parentName:"li"},"SchemaFieldDefinition")," system schemas"),(0,n.kt)("li",{parentName:"ul"},"They are published as reusable data schemas and can be used in many applications"),(0,n.kt)("li",{parentName:"ul"},"System schemas may have unique procedures for ",(0,n.kt)("a",{parentName:"li",href:"/specification/data-types/documents#reduction"},(0,n.kt)("em",{parentName:"a"},"reduction")),", ",(0,n.kt)("a",{parentName:"li",href:"/specification/data-types/documents#reconciliation"},(0,n.kt)("em",{parentName:"a"},"reconciliation"))," and ",(0,n.kt)("em",{parentName:"li"},"persistence")," of their documents")))),(0,n.kt)("h3",{id:"schema-id"},"Schema ID"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"Schema ids are strings that uniquely identify a schema"),(0,n.kt)("li",{parentName:"ul"},"Every system schema's schema id is given in that schema's section below",(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},"They always start with the schema's name in snake case"),(0,n.kt)("li",{parentName:"ul"},"Then an underscore separator"),(0,n.kt)("li",{parentName:"ul"},"Then the letter v, followed by the schema's version number as an integer"),(0,n.kt)("li",{parentName:"ul"},"Example: ",(0,n.kt)("inlineCode",{parentName:"li"},"key_group_v1")))),(0,n.kt)("li",{parentName:"ul"},"Application schema ids are constructed from the schema's name and document view id",(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},"They consist of sections separated by an underscore"),(0,n.kt)("li",{parentName:"ul"},"The first section is the name, which must have 1-64 characters, must start with a letter and must contain only alphanumeric characters and underscores"),(0,n.kt)("li",{parentName:"ul"},"The remaining sections are the document view id of the schema's ",(0,n.kt)("inlineCode",{parentName:"li"},"schema_definition_v1")," document, represented as alphabetically sorted hex-encoded operation ids, separated by underscores."),(0,n.kt)("li",{parentName:"ul"},"Example ",(0,n.kt)("inlineCode",{parentName:"li"},"profile_picture_0020c65567ae37efea293e34a9c7d13f8f2bf23dbdc3b5c7b9ab46293111c48fc78b")))),(0,n.kt)("li",{parentName:"ul"},"As application schema ids can potentially grow very large the ",(0,n.kt)("em",{parentName:"li"},"schema hash id")," is an alternative identifier with limited size",(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},"Unless a limited-size identifier is required, the regular ",(0,n.kt)("em",{parentName:"li"},"schema id")," should be preferred as it's not possible to reconstruct the schema document from the ",(0,n.kt)("em",{parentName:"li"},"schema hash id")),(0,n.kt)("li",{parentName:"ul"},"The schema hash id is constructed by concatenating",(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},"The schema's ",(0,n.kt)("em",{parentName:"li"},"name")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("strong",{parentName:"li"},"Two")," underscore characters (",(0,n.kt)("inlineCode",{parentName:"li"},"__"),")"),(0,n.kt)("li",{parentName:"ul"},"The schema's ",(0,n.kt)("em",{parentName:"li"},"document view hash id")),(0,n.kt)("li",{parentName:"ul"},"Example: ",(0,n.kt)("inlineCode",{parentName:"li"},"profile_picture__0020c65567ae37efea293e34a9c7d13f8f2bf23dbdc3b5c7b9ab46293111c48fc78b"))))))),(0,n.kt)("admonition",{title:"Requirement SC9",type:"caution"},(0,n.kt)("p",{parentName:"admonition"},"The name string in an application schema which MUST have 1-64 characters, MUST start with a letter and MUST contain only alphanumeric characters and underscores.")),(0,n.kt)("h2",{id:"system-schemas"},"System Schemas"),(0,n.kt)("h3",{id:"schema-definition"},"Schema Definition"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"Schema id: ",(0,n.kt)("inlineCode",{parentName:"li"},"schema_definition_v1")),(0,n.kt)("li",{parentName:"ul"},"Used to publish ",(0,n.kt)("a",{parentName:"li",href:"#system-and-application-schemas"},"application schemas")),(0,n.kt)("li",{parentName:"ul"},"Fields:",(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("inlineCode",{parentName:"li"},"name"),": string"),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("inlineCode",{parentName:"li"},"description"),": string"),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("inlineCode",{parentName:"li"},"fields"),": a pinned relation list referencing ",(0,n.kt)("inlineCode",{parentName:"li"},"schema_field_definition_v1")," documents")))),(0,n.kt)("h3",{id:"schema-field-definition"},"Schema Field Definition"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"Schema id: ",(0,n.kt)("inlineCode",{parentName:"li"},"schema_field_definition_v1")),(0,n.kt)("li",{parentName:"ul"},"Defines individual fields for ",(0,n.kt)("a",{parentName:"li",href:"#schema-definition"},"schema definitions")),(0,n.kt)("li",{parentName:"ul"},"Fields:",(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("inlineCode",{parentName:"li"},"name"),": string"),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("inlineCode",{parentName:"li"},"type"),": string")))),(0,n.kt)("admonition",{title:"Requirement SC10",type:"caution"},(0,n.kt)("p",{parentName:"admonition"},(0,n.kt)("inlineCode",{parentName:"p"},"schema_field_definition_v1")," ",(0,n.kt)("em",{parentName:"p"},"type")," field MUST be one of"),(0,n.kt)("ul",{parentName:"admonition"},(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("inlineCode",{parentName:"li"},"bool"),": boolean"),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("inlineCode",{parentName:"li"},"int"),": integer number"),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("inlineCode",{parentName:"li"},"float"),": floating point number"),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("inlineCode",{parentName:"li"},"bytes"),": bytes string"),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("inlineCode",{parentName:"li"},"str"),": text string"),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("inlineCode",{parentName:"li"},"relation(<schema_id>)"),": reference to a document"),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("inlineCode",{parentName:"li"},"relation_list(<schema_id>)"),": a list of references to documents"),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("inlineCode",{parentName:"li"},"pinned_relation(<schema_id>)"),": reference to a document view"),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("inlineCode",{parentName:"li"},"pinned_relation_list(<schema_id>)"),": a list of references to document views")),(0,n.kt)("p",{parentName:"admonition"},"All ",(0,n.kt)("em",{parentName:"p"},"relation")," field types need to specify a schema"),(0,n.kt)("ul",{parentName:"admonition"},(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("inlineCode",{parentName:"li"},"<schema_id>")," in the above listing needs to be a valid schema id"),(0,n.kt)("li",{parentName:"ul"},"Documents referenced by any relation field, to which this schema field definition applies, need to be of this schema"),(0,n.kt)("li",{parentName:"ul"},"E.g. if you are publishing an operation to update a field with the type ",(0,n.kt)("inlineCode",{parentName:"li"},"relation(key_group_v1)"),", the field value\nneeds to be the document id of a ",(0,n.kt)("inlineCode",{parentName:"li"},"key_group_v1")," document"))))}d.isMDXComponent=!0}}]);