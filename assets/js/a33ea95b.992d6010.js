(self.webpackChunkhandbook=self.webpackChunkhandbook||[]).push([[4189],{5420:(e,t,i)=>{e.exports={src:{srcSet:i.p+"assets/ideal-img/networking-flow-diagram.02a26da.1287.png 1287w",images:[{path:i.p+"assets/ideal-img/networking-flow-diagram.02a26da.1287.png",width:1287,height:970}],src:i.p+"assets/ideal-img/networking-flow-diagram.02a26da.1287.png",toString:function(){return i.p+"assets/ideal-img/networking-flow-diagram.02a26da.1287.png"},placeholder:void 0,width:1287,height:970},preSrc:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAHCAYAAAAxrNxjAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA5UlEQVQYlR3Ky07CQBiA0Xn/l3DnUo0bEwMhiKIthLjAS4K2WmkLDO2005l/sJJ8RtfnKCvfuMORjamJp2sexjnxbcHd2JIXgvQBKwG1KTbs85LZKiFNJthdTFXOsF7Q2rMtBL0NqOwtIVm+4H56sqjmfahJbyp837Na7phcrFiMMlTjDmgbuE5euT/LmJx8MD39ZJ9e0dYpnbR03qAW85bR0HA5L9GtYEOglUD1NcDUOY070nQB9fzUEUWW87hEG4914R/WhacyQuuEphNUJ4HaCoNHzc44jPXUrSOaWta558//4i9+PgFnk989WwAAAABJRU5ErkJggg=="}},2233:(e,t,i)=>{"use strict";i.d(t,{Z:()=>s});var n=i(7294),a=i(5944);const r="image-frame_fg61",o="image-frame-inner_Xabn",l="image-frame-title_UNlE";function s(e){let{title:t,url:i}=e;return i?n.createElement("div",{className:r},n.createElement("div",{className:o},n.createElement(a.Z,{alt:t,title:t,img:i})),t&&n.createElement("div",{className:l},t)):null}},7132:(e,t,i)=>{"use strict";i.r(t),i.d(t,{assets:()=>p,contentTitle:()=>l,default:()=>u,frontMatter:()=>o,metadata:()=>s,toc:()=>d});var n=i(7462),a=(i(7294),i(4137)),r=i(2233);const o={id:"networking",title:"Networking"},l=void 0,s={unversionedId:"specification/networking/networking",id:"specification/networking/networking",title:"Networking",description:"Introduction",source:"@site/docs/specification/networking/networking.md",sourceDirName:"specification/networking",slug:"/specification/networking/",permalink:"/specification/networking/",draft:!1,tags:[],version:"current",frontMatter:{id:"networking",title:"Networking"},sidebar:"specification",previous:{title:"Clients and nodes",permalink:"/specification/networking/clients-nodes"},next:{title:"Replication",permalink:"/specification/replication"}},p={},d=[{value:"Introduction",id:"introduction",level:2},{value:"<code>libp2p</code>",id:"libp2p",level:3},{value:"Primitives",id:"primitives",level:4},{value:"Node networking flow diagram",id:"node-networking-flow-diagram",level:4},{value:"Scope of this document",id:"scope-of-this-document",level:2},{value:"Transport Layer",id:"transport-layer",level:2},{value:"Discovery",id:"discovery",level:2},{value:"mDNS",id:"mdns",level:3},{value:"Rendezvous server",id:"rendezvous-server",level:3},{value:"Identify",id:"identify",level:4},{value:"Connectivity",id:"connectivity",level:2},{value:"Direct connection",id:"direct-connection",level:3},{value:"Relayed connection",id:"relayed-connection",level:3},{value:"Autonat",id:"autonat",level:4},{value:"Direct Connection Upgrade through Relay (DCUtR)",id:"direct-connection-upgrade-through-relay-dcutr",level:4},{value:"<code>aquadoggo</code>",id:"aquadoggo",level:2}],c={toc:d};function u(e){let{components:t,...o}=e;return(0,a.kt)("wrapper",(0,n.Z)({},c,o,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("h2",{id:"introduction"},"Introduction"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},'In p2panda "nodes" are the peers who participate actively on the network, storing and replicating data.'),(0,a.kt)("li",{parentName:"ul"},"In order to achieve this they need to be have certain capabilities, these are:",(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"the ability to find the addresses of other peers on their network"),(0,a.kt)("li",{parentName:"ul"},"the ability to establish channels of communication with a peer whose address they have"))),(0,a.kt)("li",{parentName:"ul"},"Patterns needed for achieving these conditions can be described as ",(0,a.kt)("em",{parentName:"li"},"discovery")," and ",(0,a.kt)("em",{parentName:"li"},"connectivity"),"."),(0,a.kt)("li",{parentName:"ul"},"This document outlines how p2panda implements the required functionality.")),(0,a.kt)("h3",{id:"libp2p"},(0,a.kt)("inlineCode",{parentName:"h3"},"libp2p")),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"libp2p")," is a collection of general purpose, modular, p2p networking protocols which we use to build our own stack on top of"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"https://docs.libp2p.io/concepts/introduction/overview/"},"https://docs.libp2p.io/concepts/introduction/overview/")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"aquadoggo")," uses ",(0,a.kt)("a",{parentName:"li",href:"https://github.com/libp2p/rust-libp2p"},(0,a.kt)("inlineCode",{parentName:"a"},"rust-libp2p")))),(0,a.kt)("h4",{id:"primitives"},"Primitives"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"addressing / multiaddr : ",(0,a.kt)("a",{parentName:"li",href:"https://github.com/libp2p/specs/tree/master/addressing"},"https://github.com/libp2p/specs/tree/master/addressing")),(0,a.kt)("li",{parentName:"ul"},"peer ids : ",(0,a.kt)("a",{parentName:"li",href:"https://github.com/libp2p/specs/blob/master/peer-ids/peer-ids.md"},"https://github.com/libp2p/specs/blob/master/peer-ids/peer-ids.md"))),(0,a.kt)("h4",{id:"node-networking-flow-diagram"},"Node networking flow diagram"),(0,a.kt)(r.Z,{title:"Flow diagram of networking logic on an aquadoggo by @glyph",url:i(5420),mdxType:"ImageFrame"}),(0,a.kt)("h2",{id:"scope-of-this-document"},"Scope of this document"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"in this document we define the basic mechanisms for enabling peer discovery and connectivity over."),(0,a.kt)("li",{parentName:"ul"},"we do not specify solutions for how peers manage and secure network membership, this can be facilitated by secret network keys and/or integration with existing secure, private networking solutions such as tor, i2p or wireguard.")),(0,a.kt)("h2",{id:"transport-layer"},"Transport Layer"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"p2panda uses ",(0,a.kt)("a",{parentName:"li",href:"https://en.wikipedia.org/wiki/QUIC"},"QUIC")," as the transport for all application communication between peers."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"libp2p")," QUIC specification: ",(0,a.kt)("a",{parentName:"li",href:"https://github.com/libp2p/specs/tree/master/quic"},"https://github.com/libp2p/specs/tree/master/quic"))),(0,a.kt)("h2",{id:"discovery"},"Discovery"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"in a network where peers are dynamically joining, or their public addresses may be changing, some public infrastructure and discovery mechanism is required for peer bootstrapping and live discovery. Such a mechanism allows for a peer to discover the addresses of other peers via intermediary bootstrap nodes."),(0,a.kt)("li",{parentName:"ul"},"any node can act as a bootstrap node once they have joined a network.")),(0,a.kt)("h3",{id:"mdns"},"mDNS"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"peers existing on the same LAN can discover each other over mDNS and then initiate connections."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"libp2p")," mDNS discovery specification: ",(0,a.kt)("a",{parentName:"li",href:"https://github.com/libp2p/specs/blob/master/discovery/mdns.md"},"https://github.com/libp2p/specs/blob/master/discovery/mdns.md"))),(0,a.kt)("h3",{id:"rendezvous-server"},"Rendezvous server"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"for peers who want to initiate discovery with remote peers, bootstrapping mechanisms are handled by a rendezvous servers."),(0,a.kt)("li",{parentName:"ul"},"a rendezvous server handles registering new peers and making their addresses known to other peers the same network."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"libp2p")," rendezvous server specification: ",(0,a.kt)("a",{parentName:"li",href:"https://github.com/libp2p/specs/tree/master/rendezvous"},"https://github.com/libp2p/specs/tree/master/rendezvous")),(0,a.kt)("li",{parentName:"ul"},"any peer on the network can act as a rendezvous peer.")),(0,a.kt)("h4",{id:"identify"},"Identify"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"libp2p")," relies on the identify protocol to exchange basic information between network peers. This includes listening and external addresses, public keys and supported network protocols."),(0,a.kt)("li",{parentName:"ul"},"The identify protocol provides a vital mechanism for a peer to learn it's external address before registering with a rendezvous server. Without this information, rendezvous registration will fail (another option is for the external address to be added manually in code)."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"libp2p")," identify protocol specification: ",(0,a.kt)("a",{parentName:"li",href:"https://github.com/libp2p/specs/tree/master/identify"},"https://github.com/libp2p/specs/tree/master/identify"))),(0,a.kt)("h2",{id:"connectivity"},"Connectivity"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"once peers have discovered each other, then they need to be able to establish a connection. As stated above, p2panda uses ",(0,a.kt)("inlineCode",{parentName:"li"},"QUIC")," as the transport layer for all application data. However, peers often exhibit different networking capabilities depending on several factors:",(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"do they have a static ip?"),(0,a.kt)("li",{parentName:"ul"},"are they publicly accessible over the internet?"),(0,a.kt)("li",{parentName:"ul"},"are they behind a public or private NAT?"))),(0,a.kt)("li",{parentName:"ul"},"strategies for answering these questions dynamically and negotiating how a connection can be established are required.")),(0,a.kt)("h3",{id:"direct-connection"},"Direct connection"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"the easiest situation is that one peer has a public ip address, in this case it can be dialed by the other peer on it's ",(0,a.kt)("inlineCode",{parentName:"li"},"multiaddr"),"."),(0,a.kt)("li",{parentName:"ul"},"peers listen on their announced ",(0,a.kt)("inlineCode",{parentName:"li"},"multiaddr")," for incoming connections."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"libp2p")," connection spec: ",(0,a.kt)("a",{parentName:"li",href:"https://github.com/libp2p/specs/tree/master/connections"},"https://github.com/libp2p/specs/tree/master/connections"))),(0,a.kt)("h3",{id:"relayed-connection"},"Relayed connection"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"if a peer wishes to connect to a second peer that is not publicly addressable, a third peer with a public address can act as a relay for their messages."),(0,a.kt)("li",{parentName:"ul"},"peers listen on their announced relay ",(0,a.kt)("inlineCode",{parentName:"li"},"multiaddr")," for incoming relayed connections."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"libp2p")," relay spec: ",(0,a.kt)("a",{parentName:"li",href:"https://github.com/libp2p/specs/blob/master/relay/circuit-v2.md"},"https://github.com/libp2p/specs/blob/master/relay/circuit-v2.md"))),(0,a.kt)("h4",{id:"autonat"},"Autonat"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"autonat")," is a ",(0,a.kt)("inlineCode",{parentName:"li"},"libp2p")," protocol used to establish the status of a peer's NAT."),(0,a.kt)("li",{parentName:"ul"},"any peer can respond to ",(0,a.kt)("inlineCode",{parentName:"li"},"autonat")," protocol requests."),(0,a.kt)("li",{parentName:"ul"},"the information retrieved here helps inform which connection strategies we should attempt."),(0,a.kt)("li",{parentName:"ul"},"the autonat protocol is often used to determine whether a peer should support relayed connections via a relay server (based on NAT status)."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"libp2p")," autonat specification: ",(0,a.kt)("a",{parentName:"li",href:"https://github.com/libp2p/specs/tree/master/autonat"},"https://github.com/libp2p/specs/tree/master/autonat"))),(0,a.kt)("h4",{id:"direct-connection-upgrade-through-relay-dcutr"},"Direct Connection Upgrade through Relay (DCUtR)"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"where possible relayed traffic will be upgraded to a direct connection"),(0,a.kt)("li",{parentName:"ul"},"this involves a process of learning knowledge about the nature of the NAT a peer is hidden behind and then negotiating a hole-punching procedure which ultimately results in a direct connection being established."),(0,a.kt)("li",{parentName:"ul"},"this is not always successful, but using ",(0,a.kt)("inlineCode",{parentName:"li"},"QUIC")," which runs over UDP improves the chances of success."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"libp2p")," DCUtR specification: ",(0,a.kt)("a",{parentName:"li",href:"https://github.com/libp2p/specs/blob/master/relay/DCUtR.md"},"https://github.com/libp2p/specs/blob/master/relay/DCUtR.md"))),(0,a.kt)("admonition",{type:"caution"},(0,a.kt)("p",{parentName:"admonition"},"DCUtR over ",(0,a.kt)("inlineCode",{parentName:"p"},"QUIC")," is not currently supported and DCUtR is not yet implemented in ",(0,a.kt)("inlineCode",{parentName:"p"},"aquadoggo"))),(0,a.kt)("h2",{id:"aquadoggo"},(0,a.kt)("inlineCode",{parentName:"h2"},"aquadoggo")),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"aquadoggo")," is a p2panda node and where all the networking protocols are implemented."),(0,a.kt)("li",{parentName:"ul"},"any aquadoggo peer can attempt to directly dial another peer by their ",(0,a.kt)("inlineCode",{parentName:"li"},"multiaddr")," and hope to connect over a ",(0,a.kt)("inlineCode",{parentName:"li"},"QUIC")," transport."),(0,a.kt)("li",{parentName:"ul"},'in order to enable discovery and facilitate connectivity as a/for edge peers, any node on the network can serve the above protocols in "client" and/or "server" mode. In short, an aquadoggo node can function in the following modes:',(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"rendezvous server"),(0,a.kt)("li",{parentName:"ul"},"rendezvous client"),(0,a.kt)("li",{parentName:"ul"},"relay server"),(0,a.kt)("li",{parentName:"ul"},"relay client"))),(0,a.kt)("li",{parentName:"ul"},"The network modes can also be combined. For example, a node may run as both a relay client and rendezvous client or both a relay server and rendezvous server.")))}u.isMDXComponent=!0}}]);