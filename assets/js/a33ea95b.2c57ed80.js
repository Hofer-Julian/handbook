(self.webpackChunkhandbook=self.webpackChunkhandbook||[]).push([[4189],{5420:(e,t,n)=>{e.exports={src:{srcSet:n.p+"assets/ideal-img/networking-flow-diagram.02a26da.1287.png 1287w",images:[{path:n.p+"assets/ideal-img/networking-flow-diagram.02a26da.1287.png",width:1287,height:970}],src:n.p+"assets/ideal-img/networking-flow-diagram.02a26da.1287.png",toString:function(){return n.p+"assets/ideal-img/networking-flow-diagram.02a26da.1287.png"},placeholder:void 0,width:1287,height:970},preSrc:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAHCAYAAAAxrNxjAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA5UlEQVQYlR3Ky07CQBiA0Xn/l3DnUo0bEwMhiKIthLjAS4K2WmkLDO2005l/sJJ8RtfnKCvfuMORjamJp2sexjnxbcHd2JIXgvQBKwG1KTbs85LZKiFNJthdTFXOsF7Q2rMtBL0NqOwtIVm+4H56sqjmfahJbyp837Na7phcrFiMMlTjDmgbuE5euT/LmJx8MD39ZJ9e0dYpnbR03qAW85bR0HA5L9GtYEOglUD1NcDUOY070nQB9fzUEUWW87hEG4914R/WhacyQuuEphNUJ4HaCoNHzc44jPXUrSOaWta558//4i9+PgFnk989WwAAAABJRU5ErkJggg=="}},2233:(e,t,n)=>{"use strict";n.d(t,{Z:()=>l});var i=n(7294),a=n(5944);const o="image-frame_fg61",r="image-frame-inner_Xabn",s="image-frame-title_UNlE";function l(e){let{title:t,url:n}=e;return n?i.createElement("div",{className:o},i.createElement("div",{className:r},i.createElement(a.Z,{alt:t,title:t,img:n})),t&&i.createElement("div",{className:s},t)):null}},7132:(e,t,n)=>{"use strict";n.r(t),n.d(t,{assets:()=>d,contentTitle:()=>s,default:()=>u,frontMatter:()=>r,metadata:()=>l,toc:()=>p});var i=n(7462),a=(n(7294),n(4137)),o=n(2233);const r={id:"networking",title:"Networking"},s=void 0,l={unversionedId:"specification/networking/networking",id:"specification/networking/networking",title:"Networking",description:"Introduction",source:"@site/docs/specification/networking/networking.md",sourceDirName:"specification/networking",slug:"/specification/networking/",permalink:"/specification/networking/",draft:!1,tags:[],version:"current",frontMatter:{id:"networking",title:"Networking"},sidebar:"specification",previous:{title:"Clients and nodes",permalink:"/specification/networking/clients-nodes"},next:{title:"Replication",permalink:"/specification/replication"}},d={},p=[{value:"Introduction",id:"introduction",level:2},{value:"Terminology",id:"terminology",level:2},{value:"Strategies",id:"strategies",level:2},{value:"Internet layer with libp2p",id:"internet-layer-with-libp2p",level:3},{value:"Core Abstractions",id:"core-abstractions",level:4},{value:"Diagram",id:"diagram",level:4},{value:"Transport Layer",id:"transport-layer",level:4},{value:"Discovery",id:"discovery",level:4},{value:"mDNS",id:"mdns",level:5},{value:"Rendezvous Nodes",id:"rendezvous-nodes",level:5},{value:"Identity",id:"identity",level:4},{value:"Connectivity",id:"connectivity",level:4},{value:"Direct connection",id:"direct-connection",level:5},{value:"Relayed connection",id:"relayed-connection",level:5},{value:"Direct Connection Upgrade through Relay (DCUtR)",id:"direct-connection-upgrade-through-relay-dcutr",level:5},{value:"<code>aquadoggo</code> networking modes",id:"aquadoggo-networking-modes",level:4},{value:"Security and privacy",id:"security-and-privacy",level:4},{value:"Tor Strategy",id:"tor-strategy",level:3}],c={toc:p};function u(e){let{components:t,...r}=e;return(0,a.kt)("wrapper",(0,i.Z)({},c,r,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("h2",{id:"introduction"},"Introduction"),(0,a.kt)("p",null,"p2panda doesn't have a strict specification around it's networking layer. We\nwant p2panda to be used in all sorts of contexts, let it be Low-Energy\nBluetooth, LoRa, Tor, Mesh Networks, internet or anything else."),(0,a.kt)("h2",{id:"terminology"},"Terminology"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"In p2panda ",(0,a.kt)("em",{parentName:"li"},"nodes")," participate actively in the network, storing and replicating\ndata with each other."),(0,a.kt)("li",{parentName:"ul"},"In order to achieve this, certain networking guarantees need to be met:",(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"Nodes must know or be able to discover the addresses of other nodes on\ntheir network"),(0,a.kt)("li",{parentName:"ul"},"Nodes must be able to establish (uni- or bi-directional) channels of\ncommunication with other nodes at these known addresses"))),(0,a.kt)("li",{parentName:"ul"},"Patterns needed for achieving these conditions can be described as\n",(0,a.kt)("em",{parentName:"li"},"discovery")," and ",(0,a.kt)("em",{parentName:"li"},"connectivity"),".")),(0,a.kt)("admonition",{type:"info"},(0,a.kt)("p",{parentName:"admonition"},"While the current ",(0,a.kt)("a",{parentName:"p",href:"/specification/replication"},"replication protocol")," assumes a bi-directional communication\nchannel it would be theoretically possible to build p2panda on top of a\nbroadcast-only networking topology (for example on top of LoRa or other radio\nprotocols). The append-only nature of the underlying p2panda data type make\nthis a good fit.")),(0,a.kt)("h2",{id:"strategies"},"Strategies"),(0,a.kt)("p",null,"Rather than giving strict requirements we are listing currently known,\nimplemented and recommended strategies for different networks to achieve\nconnectivity and discovery of nodes."),(0,a.kt)("p",null,"Developers can see these recommendations as starting points for their own\napproaches, experiment with their own or fork and build on top of them."),(0,a.kt)("h3",{id:"internet-layer-with-libp2p"},"Internet layer with libp2p"),(0,a.kt)("p",null,"To achieve discovery and connectivity on top of the internet layer in the\ninternet protocol suite we've successfully implemented a stack based on top of\nthe ",(0,a.kt)("a",{parentName:"p",href:"https://libp2p.io"},"libp2p")," protocol using ",(0,a.kt)("a",{parentName:"p",href:"https://en.wikipedia.org/wiki/QUIC"},"QUIC")," with TLS encryption as the underlying\ntransport layer."),(0,a.kt)("p",null,"libp2p is a collection of general purpose, modular, p2p networking protocols.\nIt solves discovery of nodes in local networks (via mDNS) and the internet (via\nRendezvous nodes) and establishes connectivity between them, even when they are\nbehind firewalls or NATs (via UDP holepunching and / or Relay nodes)."),(0,a.kt)("p",null,"This strategy is currently implemented in our ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/p2panda/aquadoggo/"},(0,a.kt)("inlineCode",{parentName:"a"},"aquadoggo"))," reference\nimplementation."),(0,a.kt)("h4",{id:"core-abstractions"},"Core Abstractions"),(0,a.kt)("p",null,"libp2p comes with its own set of core abstractions and data types which are\nused throughout the system. While p2panda does ",(0,a.kt)("em",{parentName:"p"},"not")," make use of them in its\nown core specification, they are part of this strategy."),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"https://github.com/libp2p/specs/blob/master/addressing/README.md"},"Addressing"),(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"Working with addresses in libp2p."))),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"https://github.com/libp2p/specs/blob/master/connections/README.md"},"Connections and\nUpgrading"),(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"Establishing secure, multiplexed connections between nodes, possibly over\ninsecure, single stream transports."))),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"https://github.com/libp2p/specs/blob/master/peer-ids/peer-ids.md"},"Peer Ids and\nKeys")," -\nPublic key types & encodings, peer id calculation, and message signing\nsemantics")),(0,a.kt)("h4",{id:"diagram"},"Diagram"),(0,a.kt)(o.Z,{title:"Flow diagram of aquadoggo networking strategy by @glyph",url:n(5420),mdxType:"ImageFrame"}),(0,a.kt)("h4",{id:"transport-layer"},"Transport Layer"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"aquadoggo")," uses ",(0,a.kt)("a",{parentName:"li",href:"https://en.wikipedia.org/wiki/QUIC"},"QUIC")," as the transport\nlayer for communication between nodes"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"libp2p")," QUIC specification: ",(0,a.kt)("a",{parentName:"li",href:"https://github.com/libp2p/specs/tree/master/quic"},"https://github.com/libp2p/specs/tree/master/quic"))),(0,a.kt)("h4",{id:"discovery"},"Discovery"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Addresses can be added manually if they're known and static"),(0,a.kt)("li",{parentName:"ul"},"On the same local network, discovery is achieved via mDNS"),(0,a.kt)("li",{parentName:"ul"},"Otherwise we're utilising ",(0,a.kt)("em",{parentName:"li"},"Rendezvous Nodes")," to allow discovery over the\ninternet for nodes with dynamic addresses")),(0,a.kt)("h5",{id:"mdns"},"mDNS"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Nodes existing on the same LAN can discover each other over mDNS and then\ninitiate connections"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"libp2p")," mDNS discovery specification:\n",(0,a.kt)("a",{parentName:"li",href:"https://github.com/libp2p/specs/blob/master/discovery/mdns.md"},"https://github.com/libp2p/specs/blob/master/discovery/mdns.md"))),(0,a.kt)("h5",{id:"rendezvous-nodes"},"Rendezvous Nodes"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"A rendezvous server handles registering new nodes and making their addresses\nknown to other nodes on the same network"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"libp2p")," rendezvous server specification:\n",(0,a.kt)("a",{parentName:"li",href:"https://github.com/libp2p/specs/tree/master/rendezvous"},"https://github.com/libp2p/specs/tree/master/rendezvous")),(0,a.kt)("li",{parentName:"ul"},"Any node on the network can act as a rendezvous node")),(0,a.kt)("h4",{id:"identity"},"Identity"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"libp2p")," relies on the identify protocol to exchange basic information\nbetween nodes. This includes identification of external addresses, exhange of\nunique identifiers and supported network protocols"),(0,a.kt)("li",{parentName:"ul"},"The identify protocol provides a vital mechanism for a node to learn it's\nexternal address before registering with a rendezvous server. Without this\ninformation, rendezvous registration will fail"),(0,a.kt)("li",{parentName:"ul"},"p2panda does not have a strong recommendation around node identities. The\nidentity is derived from the key pair and hashed to not leak the original\npublic key. It is possible to generate the key pair newly on each start of a\nnode"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"libp2p")," identify protocol specification:\n",(0,a.kt)("a",{parentName:"li",href:"https://github.com/libp2p/specs/tree/master/identify"},"https://github.com/libp2p/specs/tree/master/identify"))),(0,a.kt)("h4",{id:"connectivity"},"Connectivity"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Once nodes have discovered each other, then they need to be able to establish\na connection. As stated above, ",(0,a.kt)("inlineCode",{parentName:"li"},"aquadoggo")," uses QUIC as the transport layer\nfor all application data. However, nodes often exhibit different networking\ncapabilities depending on several factors:",(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"Do they have a static ip?"),(0,a.kt)("li",{parentName:"ul"},"Are they publicly accessible over the internet?"),(0,a.kt)("li",{parentName:"ul"},"Are they behind a public or private NAT or firewall?"))),(0,a.kt)("li",{parentName:"ul"},"Strategies for answering these questions dynamically and negotiating how a\nconnection can be established are required")),(0,a.kt)("h5",{id:"direct-connection"},"Direct connection"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"The easiest situation is that one node has a public IP address, in this case\nit can be dialed by the other node on it's libp2p multiaddress"),(0,a.kt)("li",{parentName:"ul"},"Nodes listen on their announced multiaddresses for incoming connections"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"libp2p")," connection specification: ",(0,a.kt)("a",{parentName:"li",href:"https://github.com/libp2p/specs/tree/master/connections"},"https://github.com/libp2p/specs/tree/master/connections"))),(0,a.kt)("h5",{id:"relayed-connection"},"Relayed connection"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"If a node wishes to connect to a second node that is not publicly\naddressable, a third node with a public address can act as a relay for their\nmessages"),(0,a.kt)("li",{parentName:"ul"},"Nodes listen on their announced relay multiaddress for incoming, relayed\nconnections"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"libp2p")," relay specification: ",(0,a.kt)("a",{parentName:"li",href:"https://github.com/libp2p/specs/blob/master/relay/circuit-v2.md"},"https://github.com/libp2p/specs/blob/master/relay/circuit-v2.md"))),(0,a.kt)("h5",{id:"direct-connection-upgrade-through-relay-dcutr"},"Direct Connection Upgrade through Relay (DCUtR)"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Where possible, relayed traffic will be upgraded to a direct connection"),(0,a.kt)("li",{parentName:"ul"},"This involves a process of gathering knowledge about the nature of the NAT a\nnode is hidden behind and then negotiating a hole-punching procedure which\nultimately results in a direct connection being established"),(0,a.kt)("li",{parentName:"ul"},"This is not always successful, using QUIC improves the chances of success"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"libp2p")," DCUtR specification: ",(0,a.kt)("a",{parentName:"li",href:"https://github.com/libp2p/specs/blob/master/relay/DCUtR.md"},"https://github.com/libp2p/specs/blob/master/relay/DCUtR.md"))),(0,a.kt)("h4",{id:"aquadoggo-networking-modes"},(0,a.kt)("inlineCode",{parentName:"h4"},"aquadoggo")," networking modes"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},'In order to enable discovery and facilitate connectivity as a/for edge nodes,\nany node on the network can serve the above protocols in "client" and/or\n"server" mode. In short, an aquadoggo node can function in the following\nmodes:',(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"Rendezvous server"),(0,a.kt)("li",{parentName:"ul"},"Rendezvous client"),(0,a.kt)("li",{parentName:"ul"},"Relay server"),(0,a.kt)("li",{parentName:"ul"},"Relay client"))),(0,a.kt)("li",{parentName:"ul"},"The network modes can also be combined. For example, a node may run as both a\nrelay client and rendezvous client or both a relay server and rendezvous\nserver.")),(0,a.kt)("h4",{id:"security-and-privacy"},"Security and privacy"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"These strategies allow very flexible discovery and connectivity building\nblocks which vary drastically in terms of privacy and security. While\n",(0,a.kt)("inlineCode",{parentName:"li"},"aquadoggo")," by default opts into the most secure setting, depending on the\nsecurity and privacy requirements of an application different measures should\nbe taken into account"),(0,a.kt)("li",{parentName:"ul"},"Utilising Rendezvous and Relay nodes might leak IP addresses on the internet,\npotentially with untrusted and unknown nodes. It is recommended to keep a\ntable of known IP addresses instead and only connect to them. If this is not\nan option, it is recommended to run p2panda over an anonymization layer like\nTor. If Tor is not an option it is possible to only create data in a\nfederated setting where a trusted node is statically hosted and used by\nmultiple clients. This node will ",(0,a.kt)("em",{parentName:"li"},"not")," forward IP addresses from clients"),(0,a.kt)("li",{parentName:"ul"},'Nodes can connect to each other as soon as they are discovered and speak the\nsame protocol. In case it is required to isolate your network from other\n"valid" nodes but still keeping dynamic discovery intact, a form of protected\noverlay network is recommended. This can be achieved with making use of VPNs\nor adding authentication to centralised and known rendezvous points. "Network\nkeys" and such are currently not supported by libp2p / QUIC and also not\nrecommended (redundant and expensive double encryption of transported data)')),(0,a.kt)("h3",{id:"tor-strategy"},"Tor Strategy"),(0,a.kt)("p",null,"An integration of onion services in ",(0,a.kt)("inlineCode",{parentName:"p"},"aquadoggo")," is pending as soon as the Rust\nport ",(0,a.kt)("inlineCode",{parentName:"p"},"arti")," is ready. For now it can still be achieved with wrapping the node\naround an external onion service layer."))}u.isMDXComponent=!0}}]);