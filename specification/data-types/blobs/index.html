<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-specification/data-types/blobs">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.1.0">
<title data-rh="true">Blobs | p2panda</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://p2panda.org/specification/data-types/blobs"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Blobs | p2panda"><meta data-rh="true" name="description" content="The blob specification describes system schemas and validation conditions used when publishing binary application data. Blobs require their own materialization logic and these system schemas allow a node to distinguish blob documents from other application data and behave accordingly. Conceptually, blobs can be considered to be &quot;attachments&quot; on other documents. It is not intended that blobs alone serve as a general purpose content delivery system. We expect blobs to be attached to other documents via relation fields, replication and materialization logic can be optimized based on this assumption. See the blob http specification to read how blobs are materialized and served on a node."><meta data-rh="true" property="og:description" content="The blob specification describes system schemas and validation conditions used when publishing binary application data. Blobs require their own materialization logic and these system schemas allow a node to distinguish blob documents from other application data and behave accordingly. Conceptually, blobs can be considered to be &quot;attachments&quot; on other documents. It is not intended that blobs alone serve as a general purpose content delivery system. We expect blobs to be attached to other documents via relation fields, replication and materialization logic can be optimized based on this assumption. See the blob http specification to read how blobs are materialized and served on a node."><link data-rh="true" rel="icon" href="/images/deepsea-panda.svg"><link data-rh="true" rel="canonical" href="https://p2panda.org/specification/data-types/blobs"><link data-rh="true" rel="alternate" href="https://p2panda.org/specification/data-types/blobs" hreflang="en"><link data-rh="true" rel="alternate" href="https://p2panda.org/specification/data-types/blobs" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.de076f58.css">
<link rel="preload" href="/assets/js/runtime~main.c1abb974.js" as="script">
<link rel="preload" href="/assets/js/main.125a03bc.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function e(e){document.documentElement.setAttribute("data-theme",e)}var t=function(){var e=null;try{e=localStorage.getItem("theme")}catch(e){}return e}();null!==t?e(t):window.matchMedia("(prefers-color-scheme: dark)").matches?e("dark"):(window.matchMedia("(prefers-color-scheme: light)").matches,e("light"))}()</script><div id="__docusaurus">
<div role="region" aria-label="theme.common.skipToMainContent"><a href="#" class="skipToContent_fXgn">Skip to main content</a></div><nav class="navbar navbar--fixed-top navbarHideable_m1mJ"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><div class="navbar__brand"><div class="navbar__logo"><img src="/images/p2panda-book.png" class="themedImage_ToTc themedImage--light_HNdA"><img src="/images/p2panda-book.png" class="themedImage_ToTc themedImage--dark_i4oU"></div></div></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/images/p2panda-book.png" alt="p2panda Handbook" class="themedImage_ToTc themedImage--light_HNdA"><img src="/images/p2panda-book.png" alt="p2panda Handbook" class="themedImage_ToTc themedImage--dark_i4oU"></div></a><a class="navbar__item navbar__link" href="/about/">About</a><a class="navbar__item navbar__link" href="/learn/">Learn</a><a class="navbar__item navbar__link" href="/tutorials/">Tutorials</a><a class="navbar__item navbar__link" href="/libraries/">Libraries</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/specification/">Specification</a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/faq">FAQ</a><a class="navbar__item navbar__link" href="/links">Links</a><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebar_njMd sidebarWithHideableNavbar_wUlq"><a tabindex="-1" class="sidebarLogo_isFc" href="/"><img src="/images/p2panda-book.png" alt="p2panda Handbook" class="themedImage_ToTc themedImage--light_HNdA"><img src="/images/p2panda-book.png" alt="p2panda Handbook" class="themedImage_ToTc themedImage--dark_i4oU"></a><nav class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/specification/">Introduction</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/specification/key-concepts">Key Concepts</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/specification/data-types/bamboo">Core data types</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/specification/data-types/bamboo">Bamboo</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/specification/data-types/key-pairs">Key Pairs</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/specification/data-types/operations">Operations</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/specification/data-types/schemas">Schemas</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/specification/data-types/documents">Documents</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/specification/data-types/document-views">Document views</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/specification/data-types/blobs">Blobs</a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/specification/authorisation">Authorisation</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/specification/encryption">Encryption</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/specification/APIs/overview">APIs</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/specification/networking/clients-nodes">Networking</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/specification/replication">Replication</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/specification/encoding-data">Canonic Encoding</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/specification/glossary">Glossary</a></li></ul></nav></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><img src="/images/deepsea-panda.svg" width="30" class="icon-home_wWeS"></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Core data types</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Blobs</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Blobs</h1></header><p>The blob specification describes system <a href="/specification/data-types/schemas">schemas</a> and validation conditions used when publishing binary application data. Blobs require their own materialization logic and these system <a href="/specification/data-types/schemas">schemas</a> allow a node to distinguish blob <a href="/specification/data-types/documents">documents</a> from other application data and behave accordingly. Conceptually, blobs can be considered to be &quot;attachments&quot; on other <a href="/specification/data-types/documents">documents</a>. It is not intended that blobs alone serve as a general purpose content delivery system. We expect blobs to be attached to other <a href="/specification/data-types/documents">documents</a> via relation fields, replication and materialization logic can be optimized based on this assumption. See the <a href="/specification/APIs/blob-http">blob http specification</a> to read how blobs are materialized and served on a node.</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="system-schemas">System schemas<a class="hash-link" href="#system-schemas" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="blob">Blob<a class="hash-link" href="#blob" title="Direct link to heading">​</a></h3><ul><li>Schema id: <code>blob_v1</code></li><li>Representing a binary file</li><li>Fields:<ul><li><code>length</code>: length of file in bytes (u64)</li><li><code>mime_type</code> IANA mime-type (string)</li><li><code>pieces</code>: list of pieces which make up this blob (pinned relation list of <code>blob_piece_v1</code>)</li></ul></li></ul><div class="theme-admonition theme-admonition-tip alert alert--success admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><span class="panda-icon">🐻‍❄️</span></span>Why no file name or path?</div><div class="admonitionContent_S0QG"><p>We designed blobs to be as generic as possible, giving developers the option to come up with their own application schemas on top of them. Information like a file name or path is <em>optional</em> meta data. If you need it, you can for example create a schema which contains a <code>file_name</code>, <code>path</code> field and a relation to a <code>blob_v1</code> document. This can be interesting for building an application which materializes files into a specific folder structure, similar to BitTorrent.</p></div></div><div class="theme-admonition theme-admonition-caution alert alert--warning admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><span class="panda-icon">🌩️</span></span>Requirements</div><div class="admonitionContent_S0QG"><ul><li>The claimed <code>length</code> of a <code>blob_v1</code> document should be validated on publishing<ul><li>This can be done by collecting all claimed pieces and calculating total length</li><li>OR only validating that each <code>blob_piece_v1</code> is the correct length and then validating the <code>length</code> value by checking the number of items in the <code>pieces</code> list</li></ul></li><li>The claimed <code>mime_type</code> should be validated</li><li>Validating blob pieces differs if they arrive through the Client API or Replication API<ul><li>Client API: all blob pieces should already exist before publishing the <code>blob</code></li><li>Replication API: a <code>blob</code> must exist with a relation to the <code>pieces</code> before the pieces are accepted. This means we don&#x27;t accept arbitrary blob data until we know the blob hash id, as we may want to choose to lazy load a blob&#x27;s actual data.</li></ul></li><li>If a validation step fails, an error should be returned to the client and <em>all</em> related <code>blob_piece_v1</code> and the <code>blob_v1</code> entries should be deleted</li></ul></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="blob-piece">Blob Piece<a class="hash-link" href="#blob-piece" title="Direct link to heading">​</a></h3><ul><li>Schema id: <code>blob_piece_v1</code></li><li>Representing the (partial) binary data of a file</li><li>Fields:<ul><li><code>data</code>: bytes contained in this blob piece (bytes)</li></ul></li></ul><div class="theme-admonition theme-admonition-caution alert alert--warning admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><span class="panda-icon">🌩️</span></span>Requirements</div><div class="admonitionContent_S0QG"><ul><li>All blob pieces must be of maximum 256KB size</li></ul></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="notes-on-storage">Notes on Storage<a class="hash-link" href="#notes-on-storage" title="Direct link to heading">​</a></h2><ul><li><code>blob_v1</code> and <code>blob_piece_v1</code> data is persisted on a node</li><li>The materialization logic differs from other documents, see the <a href="/specification/APIs/blob-http">blob http specification</a> to read more</li></ul><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="notes-on-replication">Notes on Replication<a class="hash-link" href="#notes-on-replication" title="Direct link to heading">​</a></h2><ul><li>Nodes can choose to ignore blobs when they exceed certain minimum or maximum length requirements or have unsupported mime types</li><li>Nodes can choose to only replicate blob pieces when there is at least one relation to the blob itself from other documents</li></ul></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/specification/data-types/document-views"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Document views</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/specification/authorisation"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Authorisation</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#system-schemas" class="table-of-contents__link toc-highlight">System schemas</a><ul><li><a href="#blob" class="table-of-contents__link toc-highlight">Blob</a></li><li><a href="#blob-piece" class="table-of-contents__link toc-highlight">Blob Piece</a></li></ul></li><li><a href="#notes-on-storage" class="table-of-contents__link toc-highlight">Notes on Storage</a></li><li><a href="#notes-on-replication" class="table-of-contents__link toc-highlight">Notes on Replication</a></li></ul></div></div></div></div></main></div></div><footer class="footer_J6tW"><img class="footer-img__0Xc" src="/images/deepsea-panda.svg" width="100"><div><img class="supporters-img_P2oV" src="/images/nlnet-logo.svg" width="140"><img class="supporters-img_P2oV" src="/images/ngi-logo.png" width="200"><img class="supporters-img_P2oV" src="/images/eu-flag-logo.png" width="78"><p class="footer-text_MXRq">This project has received funding from the European Union’s Horizon 2020 research and innovation programme within the framework of the NGI-POINTER Project funded under grant agreement No 871528</p></div><p class="footer-text_MXRq">CC BY-SA 4.0<!-- --> - <a href="mailto:contributors@p2panda.org">Contact</a></p></footer></div>
<script src="/assets/js/runtime~main.c1abb974.js"></script>
<script src="/assets/js/main.125a03bc.js"></script>
</body>
</html>