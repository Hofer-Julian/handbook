<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-specification/networking/replication-protocol">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.1.0">
<title data-rh="true">Replication Protocol | p2panda</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://p2panda.org/specification/networking/replication-protocol"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Replication Protocol | p2panda"><meta data-rh="true" name="description" content="- Replication is the process by which nodes exchange entries and operations to eventually converge all to the same state"><meta data-rh="true" property="og:description" content="- Replication is the process by which nodes exchange entries and operations to eventually converge all to the same state"><link data-rh="true" rel="icon" href="/images/deepsea-panda.svg"><link data-rh="true" rel="canonical" href="https://p2panda.org/specification/networking/replication-protocol"><link data-rh="true" rel="alternate" href="https://p2panda.org/specification/networking/replication-protocol" hreflang="en"><link data-rh="true" rel="alternate" href="https://p2panda.org/specification/networking/replication-protocol" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.de076f58.css">
<link rel="preload" href="/assets/js/runtime~main.3cfe7565.js" as="script">
<link rel="preload" href="/assets/js/main.1e5b77a5.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function e(e){document.documentElement.setAttribute("data-theme",e)}var t=function(){var e=null;try{e=localStorage.getItem("theme")}catch(e){}return e}();null!==t?e(t):window.matchMedia("(prefers-color-scheme: dark)").matches?e("dark"):(window.matchMedia("(prefers-color-scheme: light)").matches,e("light"))}()</script><div id="__docusaurus">
<div role="region" aria-label="theme.common.skipToMainContent"><a href="#" class="skipToContent_fXgn">Skip to main content</a></div><nav class="navbar navbar--fixed-top navbarHideable_m1mJ"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><div class="navbar__brand"><div class="navbar__logo"><img src="/images/p2panda-book.png" class="themedImage_ToTc themedImage--light_HNdA"><img src="/images/p2panda-book.png" class="themedImage_ToTc themedImage--dark_i4oU"></div></div></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/images/p2panda-book.png" alt="p2panda Handbook" class="themedImage_ToTc themedImage--light_HNdA"><img src="/images/p2panda-book.png" alt="p2panda Handbook" class="themedImage_ToTc themedImage--dark_i4oU"></div></a><a class="navbar__item navbar__link" href="/about/">About</a><a class="navbar__item navbar__link" href="/learn/">Learn</a><a class="navbar__item navbar__link" href="/tutorials/">Tutorials</a><a class="navbar__item navbar__link" href="/libraries/">Libraries</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/specification/">Specification</a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/faq">FAQ</a><a class="navbar__item navbar__link" href="/links">Links</a><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebar_njMd sidebarWithHideableNavbar_wUlq"><a tabindex="-1" class="sidebarLogo_isFc" href="/"><img src="/images/p2panda-book.png" alt="p2panda Handbook" class="themedImage_ToTc themedImage--light_HNdA"><img src="/images/p2panda-book.png" alt="p2panda Handbook" class="themedImage_ToTc themedImage--dark_i4oU"></a><nav class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/specification/">Introduction</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/specification/key-concepts">Key Concepts</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/specification/data-types/bamboo">Core data types</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/specification/authorisation">Authorisation</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/specification/encryption">Encryption</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/specification/APIs/overview">APIs</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/specification/networking/clients-nodes">Networking</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/specification/networking/clients-nodes">Clients and nodes</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/specification/networking/discovery">Discovery</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/specification/networking/replication-protocol">Replication Protocol</a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/specification/encoding-data">Canonic Encoding</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/specification/glossary">Glossary</a></li></ul></nav></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><img src="/images/deepsea-panda.svg" width="30" class="icon-home_wWeS"></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Networking</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Replication Protocol</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Replication Protocol</h1></header><ul><li>Replication is the process by which nodes exchange entries and operations to eventually converge all to the same state<ul><li>This makes p2panda an <em>eventually consistent</em> database</li><li>Nodes autonomously share data with each other without central coordination</li></ul></li><li>Nodes may not be interested in all available data and can choose to receive only some data<ul><li>For example from a set of authors or schemas</li></ul></li></ul><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="transport-protocol">Transport protocol<a class="hash-link" href="#transport-protocol" title="Direct link to heading">​</a></h2><ul><li>p2panda replication protocol is based on the GraphQL query language<ul><li>This allows developers to easily build their p2panda replication implementations in any programming language</li><li>This allows &quot;leecher&quot; node implementations in the browser which collect and persist entries but do not communicate and replicate further with other nodes</li></ul></li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="graphql-over-http">GraphQL over HTTP<a class="hash-link" href="#graphql-over-http" title="Direct link to heading">​</a></h3><ul><li>The GraphQL queries can be made via HTTP against <code>&lt;host&gt;:2020/graphql</code></li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="graphql-over-qp2p">GraphQL over qp2p<a class="hash-link" href="#graphql-over-qp2p" title="Direct link to heading">​</a></h3><ul><li>Nodes can offer a <a href="https://github.com/maidsafe/qp2p" target="_blank" rel="noopener noreferrer">qp2p</a> endpoint on port <code>2022</code> for replication via the qp2p (QUIC, TLS 1.3) protocol</li><li>qp2p is a p2p messaging protocol sending discrete GraphQL queries over QUIC streams, it ..<ul><li>Has built-in support for the Internet Gateway Device Protocol (IGD) for automatic port forwarding for peers behind NAT-enabled routers</li><li>Is based on the QUIC streaming protocol supporting both unidirectional and bidirectional streams</li><li>Has a fault-tolerancy mechanism</li><li>Makes use of connection pooling, for reusing already opened connections</li></ul></li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="encryption">Encryption<a class="hash-link" href="#encryption" title="Direct link to heading">​</a></h3><ul><li>Data over qp2p and regular HTTP transport connection is secured via TLS 1.3</li><li>TLS certificates are self-signed certificates by default<ul><li>This allows transport encryption without a centralised certificate authority (CA)</li><li>This doesn&#x27;t give authentication but since p2panda data is already authenticated and designed to function in a trustless network setting, this doesn&#x27;t need to be reflected on this layer</li><li>Optionally a p2panda node can be moved behind a reverse-proxy providing its own certificates</li></ul></li></ul><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="replication-protocol">Replication protocol<a class="hash-link" href="#replication-protocol" title="Direct link to heading">​</a></h2><ul><li>The replication protocol defines the process of exchanging entries and p2panda operations on top of the GraphQL Node API</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="basic-replication">Basic Replication<a class="hash-link" href="#basic-replication" title="Direct link to heading">​</a></h3><ul><li>Retrieves new entries from another node</li><li>More sophisticated replication protocols can be built on top<ul><li>The &quot;basic replication&quot; protocol serves as a base</li><li>Nodes may not be interested in all available data and can choose to receive only some data, for example by only requesting operations following a certain schema</li></ul></li></ul><p><strong>Process</strong></p><ol><li>Node <code>A</code> gets latest known sequence number <code>s</code> for log <code>k</code> of author <code>p</code> from own database</li><li>Node <code>A</code> makes a GraphQL request <code>entriesNewerThanSeqNum</code> and asks Node <code>B</code> if it has newer entries of log <code>k</code> and author <code>p</code> starting from sequence number <code>s</code></li><li>Node <code>B</code> replies with a paginated list of encoded entries and operations. If it doesn&#x27;t have that log or if there are no newer entries, it replies with an empty result</li><li>Node <code>A</code> paginates through the response until it downloads all new entries, it validates them locally and stores them in its database. Node <code>A</code> can make use of the <code>certificatePool</code> field of <code>EncodedEntryAndOperation</code> if it doesn&#x27;t have the full log locally to verify it</li></ol></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/specification/networking/discovery"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Discovery</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/specification/encoding-data"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Canonic Encoding</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#transport-protocol" class="table-of-contents__link toc-highlight">Transport protocol</a><ul><li><a href="#graphql-over-http" class="table-of-contents__link toc-highlight">GraphQL over HTTP</a></li><li><a href="#graphql-over-qp2p" class="table-of-contents__link toc-highlight">GraphQL over qp2p</a></li><li><a href="#encryption" class="table-of-contents__link toc-highlight">Encryption</a></li></ul></li><li><a href="#replication-protocol" class="table-of-contents__link toc-highlight">Replication protocol</a><ul><li><a href="#basic-replication" class="table-of-contents__link toc-highlight">Basic Replication</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer_J6tW"><img class="footer-img__0Xc" src="/images/deepsea-panda.svg" width="100"><div><img class="supporters-img_P2oV" src="/images/ngi-logo.png" width="200"><img class="supporters-img_P2oV" src="/images/eu-flag-logo.png" width="78"><p class="footer-text_MXRq">This project has received funding from the European Union’s Horizon 2020 research and innovation programme within the framework of the NGI-POINTER Project funded under grant agreement No 871528</p></div><p class="footer-text_MXRq">CC BY-SA 4.0<!-- --> - <a href="mailto:contributors@p2panda.org">Contact</a></p></footer></div>
<script src="/assets/js/runtime~main.3cfe7565.js"></script>
<script src="/assets/js/main.1e5b77a5.js"></script>
</body>
</html>