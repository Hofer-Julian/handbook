<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-specification/networking/networking">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.1.0">
<title data-rh="true">Networking | p2panda</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://p2panda.org/specification/networking/"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Networking | p2panda"><meta data-rh="true" name="description" content="Introduction"><meta data-rh="true" property="og:description" content="Introduction"><link data-rh="true" rel="icon" href="/images/deepsea-panda.svg"><link data-rh="true" rel="canonical" href="https://p2panda.org/specification/networking/"><link data-rh="true" rel="alternate" href="https://p2panda.org/specification/networking/" hreflang="en"><link data-rh="true" rel="alternate" href="https://p2panda.org/specification/networking/" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.de076f58.css">
<link rel="preload" href="/assets/js/runtime~main.db1fe4dc.js" as="script">
<link rel="preload" href="/assets/js/main.125a03bc.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function e(e){document.documentElement.setAttribute("data-theme",e)}var t=function(){var e=null;try{e=localStorage.getItem("theme")}catch(e){}return e}();null!==t?e(t):window.matchMedia("(prefers-color-scheme: dark)").matches?e("dark"):(window.matchMedia("(prefers-color-scheme: light)").matches,e("light"))}()</script><div id="__docusaurus">
<div role="region" aria-label="theme.common.skipToMainContent"><a href="#" class="skipToContent_fXgn">Skip to main content</a></div><nav class="navbar navbar--fixed-top navbarHideable_m1mJ"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><div class="navbar__brand"><div class="navbar__logo"><img src="/images/p2panda-book.png" class="themedImage_ToTc themedImage--light_HNdA"><img src="/images/p2panda-book.png" class="themedImage_ToTc themedImage--dark_i4oU"></div></div></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/images/p2panda-book.png" alt="p2panda Handbook" class="themedImage_ToTc themedImage--light_HNdA"><img src="/images/p2panda-book.png" alt="p2panda Handbook" class="themedImage_ToTc themedImage--dark_i4oU"></div></a><a class="navbar__item navbar__link" href="/about/">About</a><a class="navbar__item navbar__link" href="/learn/">Learn</a><a class="navbar__item navbar__link" href="/tutorials/">Tutorials</a><a class="navbar__item navbar__link" href="/libraries/">Libraries</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/specification/">Specification</a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/faq">FAQ</a><a class="navbar__item navbar__link" href="/links">Links</a><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebar_njMd sidebarWithHideableNavbar_wUlq"><a tabindex="-1" class="sidebarLogo_isFc" href="/"><img src="/images/p2panda-book.png" alt="p2panda Handbook" class="themedImage_ToTc themedImage--light_HNdA"><img src="/images/p2panda-book.png" alt="p2panda Handbook" class="themedImage_ToTc themedImage--dark_i4oU"></a><nav class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/specification/">Introduction</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/specification/key-concepts">Key Concepts</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/specification/data-types/bamboo">Core data types</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/specification/authorisation">Authorisation</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/specification/encryption">Encryption</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/specification/APIs/overview">APIs</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/specification/networking/clients-nodes">Networking</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/specification/networking/clients-nodes">Clients and nodes</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/specification/networking/">Networking</a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/specification/replication">Replication</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/specification/encoding-data">Canonic Encoding</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/specification/glossary">Glossary</a></li></ul></nav></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><img src="/images/deepsea-panda.svg" width="30" class="icon-home_wWeS"></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Networking</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Networking</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Networking</h1></header><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="introduction">Introduction<a class="hash-link" href="#introduction" title="Direct link to heading">​</a></h2><ul><li>In p2panda &quot;nodes&quot; are the peers who participate actively on the network, storing and replicating data.</li><li>In order to achieve this they need to be have certain capabilities, these are:<ul><li>the ability to find the addresses of other peers on their network</li><li>the ability to establish channels of communication with a peer whose address they have</li></ul></li><li>Patterns needed for achieving these conditions can be described as <em>discovery</em> and <em>connectivity</em>.</li><li>This document outlines how p2panda implements the required functionality.</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="libp2p"><code>libp2p</code><a class="hash-link" href="#libp2p" title="Direct link to heading">​</a></h3><ul><li><code>libp2p</code> is a collection of general purpose, modular, p2p networking protocols which we use to build our own stack on top of</li><li><a href="https://docs.libp2p.io/concepts/introduction/overview/" target="_blank" rel="noopener noreferrer">https://docs.libp2p.io/concepts/introduction/overview/</a></li><li><code>aquadoggo</code> uses <a href="https://github.com/libp2p/rust-libp2p" target="_blank" rel="noopener noreferrer"><code>rust-libp2p</code></a></li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="primitives">Primitives<a class="hash-link" href="#primitives" title="Direct link to heading">​</a></h4><ul><li>addressing / multiaddr : <a href="https://github.com/libp2p/specs/tree/master/addressing" target="_blank" rel="noopener noreferrer">https://github.com/libp2p/specs/tree/master/addressing</a></li><li>peer ids : <a href="https://github.com/libp2p/specs/blob/master/peer-ids/peer-ids.md" target="_blank" rel="noopener noreferrer">https://github.com/libp2p/specs/blob/master/peer-ids/peer-ids.md</a></li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="node-networking-flow-diagram">Node networking flow diagram<a class="hash-link" href="#node-networking-flow-diagram" title="Direct link to heading">​</a></h4><div class="image-frame_fg61"><div class="image-frame-inner_Xabn"><div style="background-size:cover;background-repeat:no-repeat;position:relative;background-image:url(&quot;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAHCAYAAAAxrNxjAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA5UlEQVQYlR3Ky07CQBiA0Xn/l3DnUo0bEwMhiKIthLjAS4K2WmkLDO2005l/sJJ8RtfnKCvfuMORjamJp2sexjnxbcHd2JIXgvQBKwG1KTbs85LZKiFNJthdTFXOsF7Q2rMtBL0NqOwtIVm+4H56sqjmfahJbyp837Na7phcrFiMMlTjDmgbuE5euT/LmJx8MD39ZJ9e0dYpnbR03qAW85bR0HA5L9GtYEOglUD1NcDUOY070nQB9fzUEUWW87hEG4914R/WhacyQuuEphNUJ4HaCoNHzc44jPXUrSOaWta558//4i9+PgFnk989WwAAAABJRU5ErkJggg==&quot;)"><svg style="width:100%;height:auto;max-width:100%;margin-bottom:-4px" width="1287" height="970"></svg><noscript><img style="width:100%;height:auto;max-width:100%;margin-bottom:-4px;position:absolute;top:0;left:0" src="/assets/ideal-img/networking-flow-diagram.02a26da.1287.png" srcset="/assets/ideal-img/networking-flow-diagram.02a26da.1287.png 1287w" alt="Flow diagram of networking logic on an aquadoggo by @glyph" width="1287" height="970"></noscript></div></div><div class="image-frame-title_UNlE">Flow diagram of networking logic on an aquadoggo by @glyph</div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="scope-of-this-document">Scope of this document<a class="hash-link" href="#scope-of-this-document" title="Direct link to heading">​</a></h2><ul><li>in this document we define the basic mechanisms for enabling peer discovery and connectivity over.</li><li>we do not specify solutions for how peers manage and secure network membership, this can be facilitated by secret network keys and/or integration with existing secure, private networking solutions such as tor, i2p or wireguard.</li></ul><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="transport-layer">Transport Layer<a class="hash-link" href="#transport-layer" title="Direct link to heading">​</a></h2><ul><li>p2panda uses <a href="https://en.wikipedia.org/wiki/QUIC" target="_blank" rel="noopener noreferrer">QUIC</a> as the transport for all application communication between peers.</li><li><code>libp2p</code> QUIC specification: <a href="https://github.com/libp2p/specs/tree/master/quic" target="_blank" rel="noopener noreferrer">https://github.com/libp2p/specs/tree/master/quic</a></li></ul><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="discovery">Discovery<a class="hash-link" href="#discovery" title="Direct link to heading">​</a></h2><ul><li>in a network where peers are dynamically joining, or their public addresses may be changing, some public infrastructure and discovery mechanism is required for peer bootstrapping and live discovery. Such a mechanism allows for a peer to discover the addresses of other peers via intermediary bootstrap nodes.</li><li>any node can act as a bootstrap node once they have joined a network.</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="mdns">mDNS<a class="hash-link" href="#mdns" title="Direct link to heading">​</a></h3><ul><li>peers existing on the same LAN can discover each other over mDNS and then initiate connections.</li><li><code>libp2p</code> mDNS discovery specification: <a href="https://github.com/libp2p/specs/blob/master/discovery/mdns.md" target="_blank" rel="noopener noreferrer">https://github.com/libp2p/specs/blob/master/discovery/mdns.md</a></li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="rendezvous-server">Rendezvous server<a class="hash-link" href="#rendezvous-server" title="Direct link to heading">​</a></h3><ul><li>for peers who want to initiate discovery with remote peers, bootstrapping mechanisms are handled by a rendezvous servers.</li><li>a rendezvous server handles registering new peers and making their addresses known to other peers the same network.</li><li><code>libp2p</code> rendezvous server specification: <a href="https://github.com/libp2p/specs/tree/master/rendezvous" target="_blank" rel="noopener noreferrer">https://github.com/libp2p/specs/tree/master/rendezvous</a></li><li>any peer on the network can act as a rendezvous peer.</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="identify">Identify<a class="hash-link" href="#identify" title="Direct link to heading">​</a></h4><ul><li><code>libp2p</code> relies on the identify protocol to exchange basic information between network peers. This includes listening and external addresses, public keys and supported network protocols.</li><li>The identify protocol provides a vital mechanism for a peer to learn it&#x27;s external address before registering with a rendezvous server. Without this information, rendezvous registration will fail (another option is for the external address to be added manually in code).</li><li><code>libp2p</code> identify protocol specification: <a href="https://github.com/libp2p/specs/tree/master/identify" target="_blank" rel="noopener noreferrer">https://github.com/libp2p/specs/tree/master/identify</a></li></ul><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="connectivity">Connectivity<a class="hash-link" href="#connectivity" title="Direct link to heading">​</a></h2><ul><li>once peers have discovered each other, then they need to be able to establish a connection. As stated above, p2panda uses <code>QUIC</code> as the transport layer for all application data. However, peers often exhibit different networking capabilities depending on several factors:<ul><li>do they have a static ip?</li><li>are they publicly accessible over the internet?</li><li>are they behind a public or private NAT?</li></ul></li><li>strategies for answering these questions dynamically and negotiating how a connection can be established are required.</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="direct-connection">Direct connection<a class="hash-link" href="#direct-connection" title="Direct link to heading">​</a></h3><ul><li>the easiest situation is that one peer has a public ip address, in this case it can be dialed by the other peer on it&#x27;s <code>multiaddr</code>.</li><li>peers listen on their announced <code>multiaddr</code> for incoming connections.</li><li><code>libp2p</code> connection spec: <a href="https://github.com/libp2p/specs/tree/master/connections" target="_blank" rel="noopener noreferrer">https://github.com/libp2p/specs/tree/master/connections</a></li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="relayed-connection">Relayed connection<a class="hash-link" href="#relayed-connection" title="Direct link to heading">​</a></h3><ul><li>if a peer wishes to connect to a second peer that is not publicly addressable, a third peer with a public address can act as a relay for their messages.</li><li>peers listen on their announced relay <code>multiaddr</code> for incoming relayed connections.</li><li><code>libp2p</code> relay spec: <a href="https://github.com/libp2p/specs/blob/master/relay/circuit-v2.md" target="_blank" rel="noopener noreferrer">https://github.com/libp2p/specs/blob/master/relay/circuit-v2.md</a></li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="autonat">Autonat<a class="hash-link" href="#autonat" title="Direct link to heading">​</a></h4><ul><li><code>autonat</code> is a <code>libp2p</code> protocol used to establish the status of a peer&#x27;s NAT.</li><li>any peer can respond to <code>autonat</code> protocol requests.</li><li>the information retrieved here helps inform which connection strategies we should attempt.</li><li>the autonat protocol is often used to determine whether a peer should support relayed connections via a relay server (based on NAT status).</li><li><code>libp2p</code> autonat specification: <a href="https://github.com/libp2p/specs/tree/master/autonat" target="_blank" rel="noopener noreferrer">https://github.com/libp2p/specs/tree/master/autonat</a></li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="direct-connection-upgrade-through-relay-dcutr">Direct Connection Upgrade through Relay (DCUtR)<a class="hash-link" href="#direct-connection-upgrade-through-relay-dcutr" title="Direct link to heading">​</a></h4><ul><li>where possible relayed traffic will be upgraded to a direct connection</li><li>this involves a process of learning knowledge about the nature of the NAT a peer is hidden behind and then negotiating a hole-punching procedure which ultimately results in a direct connection being established.</li><li>this is not always successful, but using <code>QUIC</code> which runs over UDP improves the chances of success.</li><li><code>libp2p</code> DCUtR specification: <a href="https://github.com/libp2p/specs/blob/master/relay/DCUtR.md" target="_blank" rel="noopener noreferrer">https://github.com/libp2p/specs/blob/master/relay/DCUtR.md</a></li></ul><div class="theme-admonition theme-admonition-caution alert alert--warning admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><span class="panda-icon">🌩️</span></span>caution</div><div class="admonitionContent_S0QG"><p>DCUtR over <code>QUIC</code> is not currently supported and DCUtR is not yet implemented in <code>aquadoggo</code></p></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="aquadoggo"><code>aquadoggo</code><a class="hash-link" href="#aquadoggo" title="Direct link to heading">​</a></h2><ul><li><code>aquadoggo</code> is a p2panda node and where all the networking protocols are implemented.</li><li>any aquadoggo peer can attempt to directly dial another peer by their <code>multiaddr</code> and hope to connect over a <code>QUIC</code> transport.</li><li>in order to enable discovery and facilitate connectivity as a/for edge peers, any node on the network can serve the above protocols in &quot;client&quot; and/or &quot;server&quot; mode. In short, an aquadoggo node can function in the following modes:<ul><li>rendezvous server</li><li>rendezvous client</li><li>relay server</li><li>relay client</li></ul></li><li>The network modes can also be combined. For example, a node may run as both a relay client and rendezvous client or both a relay server and rendezvous server.</li></ul></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/specification/networking/clients-nodes"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Clients and nodes</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/specification/replication"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Replication</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#introduction" class="table-of-contents__link toc-highlight">Introduction</a><ul><li><a href="#libp2p" class="table-of-contents__link toc-highlight"><code>libp2p</code></a></li></ul></li><li><a href="#scope-of-this-document" class="table-of-contents__link toc-highlight">Scope of this document</a></li><li><a href="#transport-layer" class="table-of-contents__link toc-highlight">Transport Layer</a></li><li><a href="#discovery" class="table-of-contents__link toc-highlight">Discovery</a><ul><li><a href="#mdns" class="table-of-contents__link toc-highlight">mDNS</a></li><li><a href="#rendezvous-server" class="table-of-contents__link toc-highlight">Rendezvous server</a></li></ul></li><li><a href="#connectivity" class="table-of-contents__link toc-highlight">Connectivity</a><ul><li><a href="#direct-connection" class="table-of-contents__link toc-highlight">Direct connection</a></li><li><a href="#relayed-connection" class="table-of-contents__link toc-highlight">Relayed connection</a></li></ul></li><li><a href="#aquadoggo" class="table-of-contents__link toc-highlight"><code>aquadoggo</code></a></li></ul></div></div></div></div></main></div></div><footer class="footer_J6tW"><img class="footer-img__0Xc" src="/images/deepsea-panda.svg" width="100"><div><img class="supporters-img_P2oV" src="/images/nlnet-logo.svg" width="140"><img class="supporters-img_P2oV" src="/images/ngi-logo.png" width="200"><img class="supporters-img_P2oV" src="/images/eu-flag-logo.png" width="78"><p class="footer-text_MXRq">This project has received funding from the European Union’s Horizon 2020 research and innovation programme within the framework of the NGI-POINTER Project funded under grant agreement No 871528</p></div><p class="footer-text_MXRq">CC BY-SA 4.0<!-- --> - <a href="mailto:contributors@p2panda.org">Contact</a></p></footer></div>
<script src="/assets/js/runtime~main.db1fe4dc.js"></script>
<script src="/assets/js/main.125a03bc.js"></script>
</body>
</html>